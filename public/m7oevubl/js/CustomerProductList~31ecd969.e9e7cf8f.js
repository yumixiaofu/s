(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CustomerProductList~31ecd969"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"1dde":function(e,t,n){var r=n("d039"),a=n("b622"),i=n("2d00"),o=a("species");e.exports=function(e){return i>=51||!r((function(){var t=[],n=t.constructor={};return n[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},"4de4":function(e,t,n){"use strict";var r=n("23e7"),a=n("b727").filter,i=n("1dde"),o=n("ae40"),s=i("filter"),c=o("filter");r({target:"Array",proto:!0,forced:!s||!c},{filter:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},"6e81":function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"e",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"b",(function(){return l}));var r=n("a27e");function a(e,t){return Object(r["a"])({url:"clients_services",params:{uid:e,hostselect:t}})}function i(e){return Object(r["a"])({url:"clients_services/info",method:"post",data:e})}function o(e){return Object(r["a"])({url:"clients_services/transfer",method:"post",data:e})}function s(e){return Object(r["a"])({url:"clients_services/host",method:"delete",params:{hostid:e}})}function c(e){return Object(r["a"])({url:"clients_services/host_renew",params:e})}function u(e){return Object(r["a"])({url:"clients_services/upgrade_config",method:"post",data:e})}function l(e){return Object(r["a"])({url:"clients_services/host",method:"delete",params:e})}},"841c":function(e,t,n){"use strict";var r=n("d784"),a=n("825a"),i=n("1d80"),o=n("129f"),s=n("14c3");r("search",1,(function(e,t,n){return[function(t){var n=i(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var i=a(e),c=String(this),u=i.lastIndex;o(u,0)||(i.lastIndex=0);var l=s(i,c);return o(i.lastIndex,u)||(i.lastIndex=u),null===l?-1:l.index}]}))},bbc7:function(e,t,n){},bc20:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"box"},[n("el-table",{staticClass:"mb-10",staticStyle:{width:"100%"},attrs:{data:e.hosts,border:""},on:{"sort-change":e.sortChange,"selection-change":e.selectionChange}},[n("div",{attrs:{slot:"empty"},slot:"empty"},[!e.hosts.length&&e.tableLoading?n("span",[n("i",{staticClass:"el-icon-loading"}),e._v(" 正在加载 ... ")]):e._e(),e.hosts.length||e.tableLoading?e._e():n("span",[e._v("暂无数据")])]),n("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),n("el-table-column",{attrs:{prop:"hid",label:"ID",width:"80",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("router-link",{attrs:{to:{name:"productInnerpage",query:{id:e.id,hid:r.hid}}}},[n("el-link",{on:{click:function(t){return e.goToProduct(r.hid)}}},[e._v(e._s(r.hid))])],1)]}}])}),n("el-table-column",{attrs:{prop:"hostname",label:"产品/服务"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("router-link",{attrs:{to:{name:"productInnerpage",query:{id:e.id,hid:r.hid}}}},[n("el-link",{style:{color:r.status_color},on:{click:function(t){return e.goToProduct(r.hid)}}},[e._v(e._s(r.name))])],1),n("div",{staticClass:"second-row"},[e._v(e._s(r.domain))])]}}])}),n("el-table-column",{attrs:{prop:"dedicatedip",label:"IP",sortable:"",width:"120"}}),n("el-table-column",{attrs:{prop:"amount",label:"金额",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["免费"===r.billingcycle?n("span",[e._v("免费")]):"一次性"===r.billingcycle?n("span",[e._v(e._s(r.amount+"/"+r.billingcycle))]):n("span",[e._v(e._s(r.amount))])]}}])}),n("el-table-column",{attrs:{prop:"host_type",label:"产品类型"}}),n("el-table-column",{attrs:{prop:"billingcycle",label:"付款周期",width:"110",sortable:""}}),n("el-table-column",{attrs:{prop:"regdate",label:"订购时间",width:"145",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(" "+e._s(n.regdate?e.$moment(1e3*n.regdate).format("YYYY-MM-DD HH:mm:ss"):"-")+" ")]}}])}),n("el-table-column",{attrs:{prop:"nextduedate",label:"到期时间",width:"145",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(" "+e._s(n.nextduedate?e.$moment(1e3*n.nextduedate).format("YYYY-MM-DD HH:mm:ss"):"-")+" ")]}}])}),n("el-table-column",{attrs:{prop:"domainstatus",label:"状态",width:"100",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("el-tag",{style:{"background-color":r.status_color,color:"#ffff","border-color":r.status_color},attrs:{size:"small",type:"info"}},[e._v(" "+e._s(r.domainstatus))])]}}])}),n("el-table-column",{attrs:{label:"操作",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("el-button",{staticClass:"span-primary",attrs:{size:"small",type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.goToProduct(r.hid)}}},[e._v("编辑 ")])]}}])})],1),n("div",[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.renewHandleClick}},[e._v("续费")]),n("el-button",{attrs:{size:"mini",type:"danger",loading:e.delLoading},on:{click:e.delHandleClick}},[e._v("批量删除")])],1),n("el-pagination",{staticClass:"mt-10",attrs:{"current-page":e.search.page,"page-sizes":[10,15,20,25,50,100],"page-size":e.search.limit,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.search,"page",t)},"update:current-page":function(t){return e.$set(e.search,"page",t)},"update:pageSize":function(t){return e.$set(e.search,"limit",t)},"update:page-size":function(t){return e.$set(e.search,"limit",t)}}}),n("el-dialog",e._g(e._b({attrs:{visible:e.renewDialogVis,title:"续费",width:"800px"},on:{"update:visible":function(t){e.renewDialogVis=t},open:function(t){return e.getRenewData("init")}}},"el-dialog",e.$attrs,!1),e.$listeners),[n("el-table",{staticClass:"mb-10",attrs:{data:e.renewData.hosts,border:"",height:e.renewData.hosts.length>9?"450":""}},[n("div",{attrs:{slot:"empty"},slot:"empty"},[!e.renewData.hosts.length&&e.renewLoading?n("span",[n("i",{staticClass:"el-icon-loading"}),e._v(" 正在加载 ... ")]):e._e(),e.renewData.hosts.length||e.renewLoading?e._e():n("span",[e._v("暂无数据")])]),n("el-table-column",{attrs:{prop:"name",label:"产品/服务",sortable:""}}),n("el-table-column",{attrs:{prop:"dedicatedip",label:"IP",sortable:"",width:"110"}}),n("el-table-column",{attrs:{prop:"nextduedate",label:"当前到期时间",width:"145",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(" "+e._s(n.nextduedate?e.$moment(1e3*n.nextduedate).format("YYYY-MM-DD HH:mm"):"-")+" ")]}}])}),n("el-table-column",{attrs:{prop:"nextduedate_renew",label:"续费后到期时间",width:"145",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(" "+e._s(n.nextduedate_renew?e.$moment(1e3*n.nextduedate_renew).format("YYYY-MM-DD HH:mm"):"-")+" ")]}}])}),n("el-table-column",{attrs:{prop:"nextduedate_renew",label:"续费周期",width:"110",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("el-select",{attrs:{size:"mini"},on:{change:function(t){return e.renewCycleChange(r)}},model:{value:r.billingcycle,callback:function(t){e.$set(r,"billingcycle",t)},expression:"row.billingcycle"}},e._l(r.allow_billingcycle,(function(e,t){return n("el-option",{key:t+"cycle",attrs:{value:e.billingcycle,label:e.billingcycle_zh}})})),1)]}}])}),n("el-table-column",{attrs:{prop:"amount",label:"金额",width:"100",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("el-input-number",{staticStyle:{width:"100%"},attrs:{size:"mini",controls:!1,precision:2},on:{change:e.renewCycleChange},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])})],1),n("div",{staticClass:"tar"},[n("span",[e._v("合计："+e._s(e.renewData.currency.prefix)+e._s(e.renewData.total)+e._s(e.renewData.currency.suffix))])]),n("div",{staticClass:"mt-10"},[n("el-radio-group",{style:{width:"100%"},model:{value:e.renewUseCredit,callback:function(t){e.renewUseCredit=t},expression:"renewUseCredit"}},[e.renewData.credit>0?n("el-radio",{attrs:{label:1}},[e._v("余额"+e._s(e.renewData.currency.prefix)+e._s(e.renewData.credit)+e._s(e.renewData.currency.suffix)+"，应用至账单")]):e._e(),n("el-radio",{attrs:{label:2}},[e._v("标记为已支付，并入账")]),n("el-radio",{attrs:{label:3}},[e._v("不入账，仅创建账单")])],1)],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(t){e.renewDialogVis=!1}}},[e._v("取消")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.renewSubmit}},[e._v("确定")])],1)],1)],1)},a=[],i=(n("4de4"),n("4160"),n("d81d"),n("a9e3"),n("ac1f"),n("841c"),n("159b"),n("96cf"),n("1da1")),o=n("f6b0"),s=n("6e81"),c={data:function(){return{tableLoading:!1,id:this.$route.query.id,hosts:[],search:{uid:this.$route.query.id,currency:this.$route.query.currencyId,order:"",sort:"desc",limit:Number(localStorage.getItem("limit"))||50,page:1},total:0,selectedData:[],renewDialogVis:!1,renewData:{currency:{},hosts:[]},renewLoading:!1,renewSearch:{uid:this.$route.query.id,host_ids:[],cycles:[],amount:[]},renewUseCredit:1,delLoading:!1}},methods:{getData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,Object(o["t"])(e.search);case 3:n=t.sent,r=n.data,e.hosts=r.hosts,200!==r.status?e.$message.error(r.msg):(e.hosts=r.hosts,e.total=r.total),e.tableLoading=!1;case 8:case"end":return t.stop()}}),t)})))()},goToProduct:function(e){this.$router.push({name:"productInnerpage",query:{id:this.id,hid:e}})},sortChange:function(e,t,n){this.search.order=e.prop,"ascending"===e.order?this.search.sort="asc":this.search.sort="desc",this.getData()},handleSizeChange:function(e){this.search.page=1,this.getData()},handleCurrentChange:function(e){this.getData()},selectionChange:function(e){this.selectedData=e},renewHandleClick:function(){this.selectedData.length?(this.renewSearch.host_ids=this.selectedData.filter((function(e){return"Active"===e.domainstatus_en||"Suspended"===e.domainstatus_en||"free"===e.domainstatus_en||"onetime"===e.domainstatus_en})).map((function(e){return e.hid})),this.renewDialogVis=!0):this.$message.warning("请先选择需要续费的产品")},getRenewData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return"init"===e&&(t.renewData.hosts=[]),t.renewData.total=0,t.renewData.credit=0,t.renewLoading=!0,n.next=6,Object(o["y"])(t.$qs.stringify(t.renewSearch));case 6:r=n.sent,a=r.data,t.renewLoading=!1,200!==a.status?t.$message.error(a.msg):(t.renewData=a.data,a.data.credit<=0&&(t.renewUseCredit=2));case 10:case"end":return n.stop()}}),n)})))()},renewCycleChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e&&(e.allow_billingcycle||[]).forEach((function(t){e.billingcycle===t.billingcycle&&(e.amount=t.amount)})),t.renewSearch.cycles=[],t.renewSearch.amount=[],(t.renewData.hosts||[]).forEach((function(e){t.renewSearch.cycles[e.id]=e.billingcycle,t.renewSearch.amount[e.id]=e.amount})),t.getRenewData();case 5:case"end":return n.stop()}}),n)})))()},renewSubmit:function(){var e=this;1===this.renewUseCredit&&parseFloat(this.renewData.credit)<parseFloat(this.renewData.total)?this.$confirm("该客户的余额小于续费总金额，点击“确认”将应用用户余额，同时将账单标记为已支付并入账","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.createBill();case 1:case"end":return t.stop()}}),t)})))).catch((function(){})):this.createBill()},delHandleClick:function(){var e=this;this.$confirm("确定批量删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.delLoading=!0,t.next=3,Object(s["b"])({hostid:e.selectedData.map((function(e){return e.hid}))});case 3:n=t.sent,r=n.data,e.delLoading=!1,200!==r.status?e.$message.error(r.msg):(e.$message.success(r.msg),e.getData());case 7:case"end":return t.stop()}}),t)})))).catch((function(){}))},createBill:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={uid:e.id,host_ids:[],cycles:[],amount:[]},(e.renewData.hosts||[]).forEach((function(e){n.host_ids.push(e.id),n.cycles[e.id]=e.billingcycle,n.amount[e.id]=e.amount})),t.next=4,Object(o["z"])(e.$qs.stringify(n));case 4:r=t.sent,a=r.data,200!==a.status?e.$message.error(a.msg):(e.getData(),e.$message.success(a.msg),e.renewDialogVis=!1,1===e.renewUseCredit?(e.useCredit(a.data.invoice_id),parseFloat(e.renewData.credit)<parseFloat(e.renewData.total)&&e.markPaid(a.data.invoice_id)):2===e.renewUseCredit&&e.markPaid(a.data.invoice_id));case 7:case"end":return t.stop()}}),t)})))()},useCredit:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(o["d"])({invoiceid:e,uid:t.id});case 2:r=n.sent,a=r.data,200!==a.status&&1001!==a.status?t.$message.error(a.msg):t.$message.success(a.msg);case 5:case"end":return n.stop()}}),n)})))()},markPaid:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(o["v"])({ids:e});case 2:r=n.sent,a=r.data,200!==a.status?t.$message.error(a.msg):t.$message.success(a.msg);case 5:case"end":return n.stop()}}),n)})))()}},created:function(){this.getData()}},u=c,l=(n("f423"),n("2877")),d=Object(l["a"])(u,r,a,!1,null,"b15f8f94",null);t["default"]=d.exports},d81d:function(e,t,n){"use strict";var r=n("23e7"),a=n("b727").map,i=n("1dde"),o=n("ae40"),s=i("map"),c=o("map");r({target:"Array",proto:!0,forced:!s||!c},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},f423:function(e,t,n){"use strict";var r=n("bbc7"),a=n.n(r);a.a},f6b0:function(e,t,n){"use strict";n.d(t,"q",(function(){return a})),n.d(t,"s",(function(){return i})),n.d(t,"n",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"r",(function(){return c})),n.d(t,"m",(function(){return u})),n.d(t,"l",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"j",(function(){return f})),n.d(t,"h",(function(){return h})),n.d(t,"f",(function(){return m})),n.d(t,"e",(function(){return p})),n.d(t,"u",(function(){return g})),n.d(t,"x",(function(){return b})),n.d(t,"c",(function(){return w})),n.d(t,"b",(function(){return _})),n.d(t,"p",(function(){return v})),n.d(t,"A",(function(){return y})),n.d(t,"k",(function(){return j})),n.d(t,"B",(function(){return D})),n.d(t,"t",(function(){return O})),n.d(t,"y",(function(){return x})),n.d(t,"z",(function(){return k})),n.d(t,"d",(function(){return C})),n.d(t,"v",(function(){return $})),n.d(t,"o",(function(){return S})),n.d(t,"i",(function(){return R})),n.d(t,"w",(function(){return z}));var r=n("a27e");function a(e){return Object(r["a"])({url:"client_list",method:"post",data:e})}function i(e){return Object(r["a"])({url:"summary?client_id=".concat(e)})}function o(){return Object(r["a"])({url:"create_client"})}function s(e){return Object(r["a"])({url:"create_client_post",method:"post",data:e})}function c(e){return Object(r["a"])({url:"profile/".concat(e)})}function u(e){return Object(r["a"])({url:"profile_post",method:"post",data:e})}function l(e){return Object(r["a"])({url:"delete_client/".concat(e)})}function d(e){return Object(r["a"])({url:"close_client/".concat(e)})}function f(e){return Object(r["a"])({url:"user_invoice",params:e})}function h(e,t){return Object(r["a"])({url:"close_client/".concat(e),params:t})}function m(e){return Object(r["a"])({url:"client_ticket",params:e})}function p(e){return Object(r["a"])({url:"log_record",params:e})}function g(e){return Object(r["a"])({url:"login_by_user/"+e})}function b(e){return Object(r["a"])({url:"certifi_person_detail/".concat(e)})}function w(e){return Object(r["a"])({url:"add_user_invoice",method:"post",data:e})}function _(e){return Object(r["a"])({url:"add_recharge_invoice/"+e.uid,method:"post",data:e})}function v(e){return Object(r["a"])({url:"get_user",params:e})}function y(e){return Object(r["a"])({url:"request_cancel_list",params:e})}function j(e){return Object(r["a"])({url:"request_cancel_list/".concat(e),method:"delete"})}function D(e){return Object(r["a"])({url:"searchlist",params:{value:e}})}function O(e){return Object(r["a"])({url:"hostbyuid",params:e})}function x(e){return Object(r["a"])({url:"clients_services/host_batch_renew_page",method:"post",data:e})}function k(e){return Object(r["a"])({url:"clients_services/host_batch_renew",method:"post",data:e})}function C(e){return Object(r["a"])({url:"clients_services/apply_credit",method:"post",data:e})}function $(e){return Object(r["a"])({url:"invoice/paid",params:e})}function S(e){return Object(r["a"])({url:"get_combine_invoices",params:e})}function R(e){return Object(r["a"])({url:"combine_invoices",method:"post",data:e})}function z(e){return Object(r["a"])({url:"post_client_notes",method:"post",data:e})}}}]);