(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["MessageWrite~31ecd969"],{"0c75":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box"},[a("h2",{staticStyle:{"font-size":"24px"}},[t._v("营销推送")]),a("el-divider"),a("el-row",{staticClass:"mb-20"},[a("el-col",{staticClass:"flexc",attrs:{span:24}},[a("span",{staticClass:"mr-20"},[t._v("推送方式")]),a("el-checkbox-group",{model:{value:t.formData.send_mothod,callback:function(e){t.$set(t.formData,"send_mothod",e)},expression:"formData.send_mothod"}},t._l(t.sendTypeOptions,(function(e,s){return a("el-checkbox",{key:s,attrs:{label:e.name}},[t._v(t._s(e.value)+" ")])})),1)],1)],1),a("el-row",{staticClass:"mb-20",attrs:{type:"flex",justify:"center"}},[a("el-col",{staticClass:"max-1366",attrs:{span:20}},[a("div",{staticClass:" wrapper__from mb-10",attrs:{"data-title":"接收客户(共"+(t.userList.length||"0")+"位客户)"}},[a("div",{staticClass:"customers-box"},t._l(t.userList,(function(e,s){return a("el-tag",{key:s,staticClass:"mr-10 mb-10",attrs:{closable:"",type:"info",size:"mini"},on:{close:function(a){return t.tagClose(e,s)}}},[t._v(" "+t._s(e.username)+t._s(e.mobile?"-"+e.mobile:"")+"-<"+t._s(e.email)+"> ")])})),1)])])],1),a("el-row",{staticClass:"mb-20",attrs:{type:"flex",justify:"center"}},[t.formData.send_mothod.includes("system")?a("el-col",{staticClass:"max-1366",attrs:{span:20}},[a("div",{staticClass:"wrapper__from mb-10",attrs:{"data-title":"站内信内容"}},[a("div",{staticClass:"email-box"},[a("el-form",{attrs:{"label-width":t.labelWidth}},[a("el-form-item",{attrs:{label:"标题"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("span",{staticStyle:{color:"#f00"}},[t._v("*")]),t._v(" 标题 ")]),a("el-input",{attrs:{size:"small"},model:{value:t.formData.system_subject,callback:function(e){t.$set(t.formData,"system_subject",e)},expression:"formData.system_subject"}})],1),a("el-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{label:""}},[a("el-upload",{ref:"attachment",attrs:{"file-list":t.attachmentfileList,action:t.attachmentAction,"before-upload":t.attachmentBeforeUpload,"on-success":t.attachmentSuccessUpload,"before-remove":t.handleRemove,"with-credentials":"",multiple:"",name:"file",accept:".png,.jpg,.jpeg,.doc,.gif,.docx,.xls,.xlsx,.ppt,.pptx,.pps,.pdf,.key,.numbers,.pages,.xml,.odt,.swf,.gz,.tgz,.bz,.bz2,.tbz,.zip,.rar,.tar.,txt,.php,.html,.htm,.js,.css,.vcf,.rtf,.rtfd,.py,.java,.rb,.sh,.pl,.sql"}},[a("span",{staticClass:"addFile"},[t._v("添加附件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传不超过 10MB 的文件")])])],1),a("el-form-item",{attrs:{label:"正文"}},[a("tinymce-editor",{ref:"editorRef1",attrs:{height:400},model:{value:t.formData.system_message,callback:function(e){t.$set(t.formData,"system_message",e)},expression:"formData.system_message"}})],1)],1)],1)])]):t._e()],1),a("el-row",{staticClass:"mb-20",attrs:{type:"flex",justify:"center"}},[t.formData.send_mothod.includes("mobile")?a("el-col",{staticClass:"max-1366",attrs:{span:20}},[a("div",{staticClass:"wrapper__from mb-10",attrs:{"data-title":"短信内容"}},[a("div",{staticClass:"message-box"},[a("el-form",{attrs:{"label-width":t.labelWidth}},[a("el-form-item",{attrs:{label:"短信模板"}},[a("el-select",{staticStyle:{width:"50%"},attrs:{size:"small"},on:{change:t.changeSMS},model:{value:t.formData.msgid,callback:function(e){t.$set(t.formData,"msgid",e)},expression:"formData.msgid"}},t._l(t.messageTemplate,(function(t,e){return a("el-option",{key:e,attrs:{label:t.title,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"短信内容"}},[a("el-input",{attrs:{type:"textarea",rows:4,disabled:""},model:{value:t.smsContent,callback:function(e){t.smsContent=e},expression:"smsContent"}})],1)],1)],1)])]):t._e()],1),a("el-row",{attrs:{type:"flex",justify:"center"}},[t.formData.send_mothod.includes("email")?a("el-col",{staticClass:"max-1366",attrs:{span:20}},[a("div",{staticClass:"wrapper__from mb-10",attrs:{"data-title":"邮件内容"}},[a("div",{staticClass:"email-box"},[a("el-form",{attrs:{"label-width":t.labelWidth}},[a("el-form-item",{attrs:{label:"主题"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("span",{staticStyle:{color:"#f00"}},[t._v("*")]),t._v(" 主题 ")]),a("el-input",{attrs:{size:"small"},model:{value:t.formData.email_subject,callback:function(e){t.$set(t.formData,"email_subject",e)},expression:"formData.email_subject"}})],1),a("el-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{label:""}},[a("el-upload",{ref:"attachmentEmail",attrs:{"file-list":t.emailfileList,action:t.attachmentAction,"before-upload":t.attachmentBeforeUploadEmail,"on-success":t.emailSuccessUpload,"before-remove":t.handleEmailRemove,"with-credentials":"",multiple:"",name:"file",accept:".png,.jpg,.jpeg,.doc,.gif,.docx,.xls,.xlsx,.ppt,.pptx,.pps,.pdf,.key,.numbers,.pages,.xml,.odt,.swf,.gz,.tgz,.bz,.bz2,.tbz,.zip,.rar,.tar.,txt,.php,.html,.htm,.js,.css,.vcf,.rtf,.rtfd,.py,.java,.rb,.sh,.pl,.sql"}},[a("span",{staticClass:"addFile"},[t._v("添加附件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传不超过 10MB 的文件")])])],1),a("el-form-item",{attrs:{label:"正文"}},[a("tinymce-editor",{ref:"editorRef",attrs:{height:400,insertTxt:t.insertTxt},model:{value:t.formData.email_message,callback:function(e){t.$set(t.formData,"email_message",e)},expression:"formData.email_message"}}),a("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.emailPreview}},[t._v("邮件预览")])],1)],1),a("el-form-item",{attrs:{label:"可用参数"}},[a("el-row",{staticClass:"available-arg"},t._l(t.baseArgs,(function(e,s){return a("el-col",{key:s+"c"},[a("span",{staticStyle:{"font-weight":"700","font-size":"14px"}},[t._v(t._s(e.name))]),t._l(e.list,(function(e,s){return a("el-col",{key:s+"b"},[a("el-col",{attrs:{xs:24,sm:12}},[a("span",[t._v(t._s(e.name))])]),a("el-col",{attrs:{xs:24,sm:12}},[a("span",{staticStyle:{cursor:"pointer"},on:{click:function(a){a.stopPropagation(),t.insertTxt=e.arg}}},[t._v(t._s(e.arg))])])],1)}))],2)})),1)],1)],1)],1)])]):t._e()],1),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{staticClass:"max-1366",attrs:{span:20,offset:2}},[a("el-form",{attrs:{"label-width":t.labelWidth}},[a("el-form-item",{attrs:{label:"发送频次"}},[t._v(" 共给"+t._s(t.userNum)+"位客户发送消息，每批发送 "),a("el-input-number",{staticStyle:{width:"80px"},attrs:{size:"small",min:1,controls:!1,precision:0},model:{value:t.formData.batch_num,callback:function(e){t.$set(t.formData,"batch_num",e)},expression:"formData.batch_num"}}),t._v(" 条，每隔 "),a("el-input-number",{staticStyle:{width:"80px"},attrs:{size:"small",min:1,controls:!1,precision:0},model:{value:t.formData.delay_time,callback:function(e){t.$set(t.formData,"delay_time",e)},expression:"formData.delay_time"}}),t._v(" 秒发送一批 ")],1),a("el-form-item",{attrs:{label:"消息类型"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("span",{staticStyle:{color:"#f00"}},[t._v("*")]),t._v(" 消息类型 ")]),a("el-radio-group",{model:{value:t.formData.is_market,callback:function(e){t.$set(t.formData,"is_market",e)},expression:"formData.is_market"}},[a("el-radio",{attrs:{label:1}},[t._v("营销信息")]),a("el-radio",{attrs:{label:0}},[t._v("普通信息")])],1)],1),a("el-form-item",{attrs:{label:"重复发送"}},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v(" 重复发送 "),a("el-popover",{attrs:{placement:"top-start",title:"",width:"200",trigger:"hover"}},[a("span",[t._v("选择”否“时，为客户匹配的首个产品发送消息，选择”是“时，客户购买的多个符合条件的产品均发送一次信息，因此客户可能会收到多条信息")]),a("i",{staticClass:"el-icon-question blue_qus",attrs:{slot:"reference"},slot:"reference"})])],1),a("el-radio-group",{model:{value:t.formData.repeat_sent,callback:function(e){t.$set(t.formData,"repeat_sent",e)},expression:"formData.repeat_sent"}},[a("el-radio",{attrs:{label:1}},[t._v("是")]),a("el-radio",{attrs:{label:0}},[t._v("否")])],1)],1)],1)],1)],1),a("div",{staticClass:"bottomOperationAdd"},[a("el-col",{staticClass:"max-1366",attrs:{span:20}},[a("el-button",{attrs:{disabled:0===t.userNum,size:"small",type:"primary",loading:t.sendLoading},on:{click:t.submit}},[t._v("发送信息 ")])],1)],1)],1)},r=[],n=(a("4de4"),a("c740"),a("4160"),a("caad"),a("a434"),a("2532"),a("159b"),a("96cf"),a("1da1")),i=a("0fe6"),l={metaInfo:{title:"营销推送"},data:function(){return{sendLoading:!1,labelWidth:window.document.body.clientWidth>768?"80px":null,smsContent:"",userList:[],query:{},messageTemplate:[],emailContent:"",insertTxt:"",baseArgs:[],userNum:0,formData:{send_mothod:["system"],send_type:"",clients:[],email_subject:"",email_message:'<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /></head><body style="margin: 0; padding: 0;"><table style="height: 100vh;" width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td style="position: relative;"><table style="margin: 0px; padding: 0px; border-collapse: collapse; width: 70vw; height: 100vh; position: absolute; top: 0; left: 15%;" cellspacing="0" cellpadding="0" align="center"><tbody><tr><td style="margin: 0px; padding: 0px; position: relative; width: 100%; height: 360px; background-color: #142467;"><span style="margin: 0px; padding: 0px; display: inline-block; position: absolute; bottom: 0; margin-left: 2%; width: 98%; height: 50px; background-color: #007bfc; box-sizing: border-box;">&nbsp;</span></td></tr><tr><td style="margin: 0px; padding: 0px; position: relative; flex: 1 1 0%; height: 506px;"><span style="margin: 0px; padding: 0px; display: inline-block; position: absolute; bottom: 0; left: 50%; width: 50%; height: 50px; background-color: #007bfc; box-sizing: border-box;">&nbsp;</span></td></tr><tr><td style="margin: 0px; padding: 0px; position: relative; width: 100%; height: 80px; background-color: #1d1f2e;">&nbsp;</td></tr></tbody></table><table style="margin: 0px; padding: 0px; border-collapse: collapse; width: 60vw; height: 100vh; position: absolute; top: 0; left: 20%;" cellspacing="0" cellpadding="0" align="center">\x3c!-- 邮件标题 --\x3e<tbody><tr style="margin: 0; padding: 0; height: 160px;"><td style="margin: 0px; padding: 0px; height: 160px; text-align: center;"><span style="margin: 0; padding: 0; display: inline-block; font-size: 32px; width: 128px; font-family: MicrosoftYaHei; letter-spacing: 0px; color: #ffffff; float: left; white-space: nowrap;"> <span style="margin: 0; padding: 0; display: inline-block; font-size: 32px; width: 128px;">&nbsp;</span></span></td></tr>\x3c!-- 邮件内容 --\x3e<tr style="margin: 0; padding: 0; height: 724px;"><td style="margin: 0px; padding: 50px 5%; font-size: 14px; box-sizing: border-box; min-height: 724px; background: #fff; box-shadow: 0px 0px 8px 0px rgba(117, 117, 117, 0.48); border-radius: 2px; line-height: 27px; color: #333333; vertical-align: initial;">&nbsp;</td></tr></tbody></table></td></tr></tbody></table></body></html>',email_attachments:[],system_subject:"",system_message:"",system_attachments:[],msgid:void 0,batch_num:30,delay_time:10,is_market:0,repeat_sent:0},sendTypeOptions:[],attachmentfileList:[],emailfileList:[],attachmentAction:this.$baseUrl+"/upload_file"}},methods:{emailPreview:function(){var t={title:this.formData.email_subject,userList:this.userList,content:this.formData.email_message,time:this.$moment().format("YYYY-MM-DD HH:mm:ss")};localStorage.setItem("emailPreviewObj",JSON.stringify(t));var e=this.$router.resolve({name:"EmailPreview"});window.open(e.href,"_blank")},submit:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.formData.send_mothod.length){e.next=3;break}return t.$message.error("请选择推送方式"),e.abrupt("return");case 3:if(0===t.formData.is_market||1===t.formData.is_market){e.next=6;break}return t.$message.error("请选择消息类型"),e.abrupt("return");case 6:if(!t.formData.send_mothod.includes("system")||t.formData.system_subject){e.next=9;break}return t.$message.error("站内信标题不能为空"),e.abrupt("return");case 9:if(!t.formData.send_mothod.includes("email")||t.formData.email_subject){e.next=12;break}return t.$message.error("邮件标题不能为空"),e.abrupt("return");case 12:t.$confirm("是否向".concat(t.userList.length,"位客户发送信息?"),"信息发送",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.formData.send_type=t.query.send_type;var e=[];t.userList.forEach((function(t){e.push(t.id)})),t.formData.clients=t.userList,t.sendLoading=!0,Object(i["e"])(t.formData).then((function(e){200!==e.data.status?(t.$message.error(e.data.msg),t.sendLoading=!1):(t.$message.success(e.data.msg),t.$router.push({name:"MarketingPush"}),t.sendLoading=!1)}))})).catch((function(){t.$message.info("已取消发送"),t.sendLoading=!1}));case 13:case"end":return e.stop()}}),e)})))()},handleRemove:function(t){var e=this.formData.system_attachments.findIndex((function(e){return e===t.response.data.savename}));-1!==e?this.formData.system_attachments.splice(e,1):this.$message.error("该文件未上传成功，请检查文件大小及后缀名是否满足要求")},handleEmailRemove:function(t){var e=this.formData.email_attachments.findIndex((function(e){return e===t.response.data.savename}));-1!==e?this.formData.email_attachments.splice(e,1):this.$message.error("该文件未上传成功，请检查文件大小及后缀名是否满足要求")},attachmentBeforeUpload:function(t){var e=t.size/1024/1024<10;return e||(this.$message.error("文件大小超过 10MB"),this.$refs.attachment.clearFiles()),e},attachmentBeforeUploadEmail:function(t){var e=t.size/1024/1024<10;return e||(this.$message.error("文件大小超过 10MB"),this.$refs.attachmentEmail.clearFiles()),e},attachmentSuccessUpload:function(t,e,a){if(200!==t.status)return this.formData.system_attachments=[],this.$message.error(t.msg),this.$refs.attachment.clearFiles(),!1;this.formData.system_attachments.push(t.data.savename)},emailSuccessUpload:function(t,e,a){if(200!==t.status)return this.formData.email_attachments=[],this.$message.error(t.msg),this.$refs.attachmentEmail.clearFiles(),!1;this.formData.email_attachments.push(t.data.savename)},changeSMS:function(t){var e=this;this.messageTemplate.filter((function(a){a.id===t&&(e.smsContent=a.content)}))},getSendMethod:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["b"])();case 2:a=e.sent,s=a.data,t.sendTypeOptions=s.data.send_method;case 5:case"end":return e.stop()}}),e)})))()},getData:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["c"])(t.query.send_type);case 2:if(a=e.sent,s=a.data,200===s.status){e.next=6;break}return e.abrupt("return",!1);case 6:t.messageTemplate=s.templates;case 7:case"end":return e.stop()}}),e)})))()},searchlist:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["d"])(t.query);case 2:a=e.sent,s=a.data,t.userNum=s.client_count,t.userList=s.data;case 6:case"end":return e.stop()}}),e)})))()},tagClose:function(t,e){this.userList.splice(e,1)},getBaseArg:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["a"])(t.query.send_type);case 2:if(a=e.sent,s=a.data,200===s.status){e.next=6;break}return e.abrupt("return",!1);case 6:t.baseArgs=s.data;case 7:case"end":return e.stop()}}),e)})))()}},created:function(){this.query=JSON.parse(localStorage.getItem("yxquery")||""),this.searchlist(),this.getData(),this.getBaseArg(),this.getSendMethod()}},o=l,c=(a("efa8"),a("2877")),m=Object(c["a"])(o,s,r,!1,null,"ea4f84c2",null);e["default"]=m.exports},"0fe6":function(t,e,a){"use strict";a.d(e,"f",(function(){return r})),a.d(e,"c",(function(){return n})),a.d(e,"e",(function(){return i})),a.d(e,"a",(function(){return l})),a.d(e,"d",(function(){return o})),a.d(e,"b",(function(){return c}));var s=a("a27e");function r(){return Object(s["a"])({url:"sm_type"})}function n(t){return Object(s["a"])({url:"mobiletemplate_list",params:{send_type:t}})}function i(t){return Object(s["a"])({url:"sendmessage_post",method:"post",data:t})}function l(t){return Object(s["a"])({url:"email_template_params",params:{send_type:t}})}function o(t){return Object(s["a"])({url:"searchlist",method:"post",data:t})}function c(){return Object(s["a"])({url:"getSendMethod"})}},"1dde":function(t,e,a){var s=a("d039"),r=a("b622"),n=a("2d00"),i=r("species");t.exports=function(t){return n>=51||!s((function(){var e=[],a=e.constructor={};return a[i]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},2532:function(t,e,a){"use strict";var s=a("23e7"),r=a("5a34"),n=a("1d80"),i=a("ab13");s({target:"String",proto:!0,forced:!i("includes")},{includes:function(t){return!!~String(n(this)).indexOf(r(t),arguments.length>1?arguments[1]:void 0)}})},"44e7":function(t,e,a){var s=a("861d"),r=a("c6b6"),n=a("b622"),i=n("match");t.exports=function(t){var e;return s(t)&&(void 0!==(e=t[i])?!!e:"RegExp"==r(t))}},"4de4":function(t,e,a){"use strict";var s=a("23e7"),r=a("b727").filter,n=a("1dde"),i=a("ae40"),l=n("filter"),o=i("filter");s({target:"Array",proto:!0,forced:!l||!o},{filter:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},"5a34":function(t,e,a){var s=a("44e7");t.exports=function(t){if(s(t))throw TypeError("The method doesn't accept regular expressions");return t}},8418:function(t,e,a){"use strict";var s=a("c04e"),r=a("9bf2"),n=a("5c6c");t.exports=function(t,e,a){var i=s(e);i in t?r.f(t,i,n(0,a)):t[i]=a}},a434:function(t,e,a){"use strict";var s=a("23e7"),r=a("23cb"),n=a("a691"),i=a("50c4"),l=a("7b0b"),o=a("65f0"),c=a("8418"),m=a("1dde"),d=a("ae40"),u=m("splice"),p=d("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,h=Math.min,b=9007199254740991,g="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!u||!p},{splice:function(t,e){var a,s,m,d,u,p,x=l(this),v=i(x.length),_=r(t,v),y=arguments.length;if(0===y?a=s=0:1===y?(a=0,s=v-_):(a=y-2,s=h(f(n(e),0),v-_)),v+a-s>b)throw TypeError(g);for(m=o(x,s),d=0;d<s;d++)u=_+d,u in x&&c(m,d,x[u]);if(m.length=s,a<s){for(d=_;d<v-s;d++)u=d+s,p=d+a,u in x?x[p]=x[u]:delete x[p];for(d=v;d>v-s+a;d--)delete x[d-1]}else if(a>s)for(d=v-s;d>_;d--)u=d+s-1,p=d+a-1,u in x?x[p]=x[u]:delete x[p];for(d=0;d<a;d++)x[d+_]=arguments[d+2];return x.length=v-s+a,m}})},ab13:function(t,e,a){var s=a("b622"),r=s("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[r]=!1,"/./"[t](e)}catch(s){}}return!1}},c16e:function(t,e,a){},c740:function(t,e,a){"use strict";var s=a("23e7"),r=a("b727").findIndex,n=a("44d2"),i=a("ae40"),l="findIndex",o=!0,c=i(l);l in[]&&Array(1)[l]((function(){o=!1})),s({target:"Array",proto:!0,forced:o||!c},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n(l)},caad:function(t,e,a){"use strict";var s=a("23e7"),r=a("4d64").includes,n=a("44d2"),i=a("ae40"),l=i("indexOf",{ACCESSORS:!0,1:0});s({target:"Array",proto:!0,forced:!l},{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("includes")},efa8:function(t,e,a){"use strict";var s=a("c16e"),r=a.n(s);r.a}}]);