(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["SupportTicketDetail~31ecd969"],{1276:function(t,e,a){"use strict";var r=a("d784"),n=a("44e7"),s=a("825a"),i=a("1d80"),o=a("4840"),c=a("8aa5"),l=a("50c4"),u=a("14c3"),d=a("9263"),m=a("d039"),f=[].push,p=Math.min,h=4294967295,g=!m((function(){return!RegExp(h,"y")}));r("split",2,(function(t,e,a){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,a){var r=String(i(this)),s=void 0===a?h:a>>>0;if(0===s)return[];if(void 0===t)return[r];if(!n(t))return e.call(r,t,s);var o,c,l,u=[],m=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),p=0,g=new RegExp(t.source,m+"g");while(o=d.call(g,r)){if(c=g.lastIndex,c>p&&(u.push(r.slice(p,o.index)),o.length>1&&o.index<r.length&&f.apply(u,o.slice(1)),l=o[0].length,p=c,u.length>=s))break;g.lastIndex===o.index&&g.lastIndex++}return p===r.length?!l&&g.test("")||u.push(""):u.push(r.slice(p)),u.length>s?u.slice(0,s):u}:"0".split(void 0,0).length?function(t,a){return void 0===t&&0===a?[]:e.call(this,t,a)}:e,[function(e,a){var n=i(this),s=void 0==e?void 0:e[t];return void 0!==s?s.call(e,n,a):r.call(String(n),e,a)},function(t,n){var i=a(r,t,this,n,r!==e);if(i.done)return i.value;var d=s(t),m=String(this),f=o(d,RegExp),v=d.unicode,b=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(g?"y":"g"),_=new f(g?d:"^(?:"+d.source+")",b),k=void 0===n?h:n>>>0;if(0===k)return[];if(0===m.length)return null===u(_,m)?[m]:[];var y=0,w=0,x=[];while(w<m.length){_.lastIndex=g?w:0;var C,O=u(_,g?m:m.slice(w));if(null===O||(C=p(l(_.lastIndex+(g?0:w)),m.length))===y)w=c(m,w,v);else{if(x.push(m.slice(y,w)),x.length===k)return x;for(var D=1;D<=O.length-1;D++)if(x.push(O[D]),x.length===k)return x;w=y=C}}return x.push(m.slice(y)),x}]}),!g)},"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},1535:function(t,e,a){},"44e7":function(t,e,a){var r=a("861d"),n=a("c6b6"),s=a("b622"),i=s("match");t.exports=function(t){var e;return r(t)&&(void 0!==(e=t[i])?!!e:"RegExp"==n(t))}},5394:function(t,e,a){"use strict";a.d(e,"e",(function(){return n})),a.d(e,"d",(function(){return s})),a.d(e,"a",(function(){return i})),a.d(e,"c",(function(){return o})),a.d(e,"b",(function(){return c}));var r=a("a27e");function n(){return Object(r["a"])({url:"list_ticket_status"})}function s(t){return Object(r["a"])({url:"list_ticket_status/"+t})}function i(t){return Object(r["a"])({url:"add_ticket_status",method:"post",data:t})}function o(t){return Object(r["a"])({url:"save_ticket_status",method:"post",data:t})}function c(t){return Object(r["a"])({url:"delete_ticket_status",method:"post",data:t})}},"841c":function(t,e,a){"use strict";var r=a("d784"),n=a("825a"),s=a("1d80"),i=a("129f"),o=a("14c3");r("search",1,(function(t,e,a){return[function(e){var a=s(this),r=void 0==e?void 0:e[t];return void 0!==r?r.call(e,a):new RegExp(e)[t](String(a))},function(t){var r=a(e,t,this);if(r.done)return r.value;var s=n(t),c=String(this),l=s.lastIndex;i(l,0)||(s.lastIndex=0);var u=o(s,c);return i(s.lastIndex,l)||(s.lastIndex=l),null===u?-1:u.index}]}))},"9c4d":function(t,e,a){"use strict";var r=a("1535"),n=a.n(r);n.a},a200:function(t,e,a){"use strict";a.d(e,"j",(function(){return n})),a.d(e,"b",(function(){return s})),a.d(e,"n",(function(){return i})),a.d(e,"q",(function(){return o})),a.d(e,"i",(function(){return c})),a.d(e,"p",(function(){return l})),a.d(e,"c",(function(){return u})),a.d(e,"f",(function(){return d})),a.d(e,"a",(function(){return m})),a.d(e,"d",(function(){return f})),a.d(e,"e",(function(){return p})),a.d(e,"g",(function(){return h})),a.d(e,"m",(function(){return g})),a.d(e,"h",(function(){return v})),a.d(e,"k",(function(){return b})),a.d(e,"l",(function(){return _})),a.d(e,"o",(function(){return k})),a.d(e,"r",(function(){return y})),a.d(e,"s",(function(){return w})),a.d(e,"t",(function(){return x}));var r=a("a27e");function n(t){return Object(r["a"])({url:"add_ticket_page",params:t})}function s(t){return Object(r["a"])({url:"add_ticket",method:"post",data:t})}function i(t){return Object(r["a"])({url:"list_ticket",params:t})}function o(t){return Object(r["a"])({url:"reply_ticket",method:"post",data:t})}function c(t){return Object(r["a"])({url:"save_ticket_reply",method:"post",data:t})}function l(t){return Object(r["a"])({url:"merge_ticket",method:"post",data:t})}function u(t){return Object(r["a"])({url:"close_ticket",method:"post",data:t})}function d(t){return Object(r["a"])({url:"delete_ticket",method:"post",data:t})}function m(t){return Object(r["a"])({url:"add_ticket_note",method:"post",data:t})}function f(t){return Object(r["a"])({url:"delete_ticket_note",method:"post",data:t})}function p(t){return Object(r["a"])({url:"delete_ticket_reply",method:"post",data:t})}function h(t){return Object(r["a"])({url:"download_ticket_attachment",params:t})}function g(t){return Object(r["a"])({url:"list_ticket/"+t})}function v(t){return Object(r["a"])({url:"save_ticket",method:"post",data:t})}function b(){return Object(r["a"])({url:"getClient"})}function _(){return Object(r["a"])({url:"getTicketDepartment"})}function k(t){return Object(r["a"])({url:"hostbyuid",params:t})}function y(t){return Object(r["a"])({url:"ticket_receive",method:"put",data:t})}function w(t){return Object(r["a"])({url:"ticket_transfer_list",params:t})}function x(t){return Object(r["a"])({url:"ticket_transfer",method:"put",data:t})}},af9c:function(t,e,a){"use strict";a.d(e,"l",(function(){return n})),a.d(e,"k",(function(){return s})),a.d(e,"h",(function(){return i})),a.d(e,"a",(function(){return o})),a.d(e,"e",(function(){return c})),a.d(e,"o",(function(){return l})),a.d(e,"c",(function(){return u})),a.d(e,"i",(function(){return d})),a.d(e,"m",(function(){return m})),a.d(e,"j",(function(){return f})),a.d(e,"d",(function(){return p})),a.d(e,"n",(function(){return h})),a.d(e,"p",(function(){return g})),a.d(e,"b",(function(){return v})),a.d(e,"g",(function(){return b})),a.d(e,"f",(function(){return _}));var r=a("a27e");function n(t){return Object(r["a"])({url:"order/search_page",params:t})}function s(t){return Object(r["a"])({url:"order/search",params:t})}function i(t){return Object(r["a"])({url:"order/check",params:t})}function o(t){return Object(r["a"])({url:"order/cancel",params:t})}function c(t){return Object(r["a"])({url:"orders/delete",method:"delete",params:t})}function l(t){return Object(r["a"])({url:"order/create_page",params:t})}function u(t){return Object(r["a"])({url:"order/create",method:"post",data:t})}function d(t){return Object(r["a"])({url:"orders/"+t})}function m(t){return Object(r["a"])({url:"orders/set_config",params:t})}function f(t){return Object(r["a"])({url:"get_total",method:"post",data:t})}function p(t){return Object(r["a"])({url:"order/save_promo_code",method:"post",data:t})}function h(t){return Object(r["a"])({url:"orders/active",method:"post",data:t})}function g(){return Object(r["a"])({url:"order/promo_code_page"})}function v(t){return Object(r["a"])({url:"orders/change_status",method:"post",data:t})}function b(t){return Object(r["a"])({url:"order/order_commission",method:"post",data:t})}function _(t){return Object(r["a"])({url:"order/getclients",params:{username:t}})}},f1234:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"detail"},[a("div",{staticClass:"detail_first"},[a("div",{staticClass:"detail_first_left"},[a("span",{staticClass:"first_left_department"},[t._v(t._s(t.related.dpt_name))]),a("span",{staticClass:"first_left_title"},[t._v("#"+t._s(t.tid)+" - "+t._s(t.formData.title))]),a("span",{staticClass:"mr-10"},[t.noPower?t._e():a("el-select",{staticClass:"mr-10",attrs:{size:"small",placeholder:"请选择"},on:{change:function(e){return t.closeTicketHandleClick(t.formData.status)}},model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},t._l(t.statusOptions,(function(t){return a("el-option",{key:t.id,style:{color:t.color},attrs:{label:t.title,value:t.id}})})),1)],1),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.closeTicketHandleClick(4,"confirm")}}},[t._v("关闭")]),t.noPower?t._e():a("el-popover",{attrs:{placement:"top-start",title:"",width:"200",trigger:"hover"}},[a("el-row",[a("el-col",{attrs:{span:24}},[t._v("根据当下环境选择对应状态，系统默认5种工单状态。")]),a("el-col",{staticClass:"tar",attrs:{span:24}},[a("router-link",{attrs:{to:{path:"work-order-status"},target:"_blank"}},[a("el-link",{attrs:{type:"primary"}},[t._v("设置工单状态")])],1)],1)],1),a("i",{staticClass:"el-icon-question blue_qus",attrs:{slot:"reference"},slot:"reference"})],1)],1),a("div",[a("span",{staticClass:"color-999 fz-12"},[t._v("处理人员：")]),a("span",{staticClass:"color-333 fz-12 mr-20"},[t._v(t._s(t.related.handle_name||"-"))]),0===t.related.handle?a("el-button",{attrs:{size:"small",type:"danger",plain:"",loading:t.receiveLoading},on:{click:t.ticketReceive}},[t._v("接单 ")]):4!==t.related.status?a("el-button",{attrs:{size:"small",type:"danger",plain:"",loading:t.handoverItemLoading},on:{click:t.handoverItem}},[t._v("移交工单 ")]):t._e(),a("span",{staticClass:"last_reply ml-20"},[t._v("上次回复于："+t._s(t.replyList[0]?t.$timeDiff(1e3*t.replyList[0].time):"-"))])],1)]),a("div",{staticClass:"detail_second"},[a("el-tabs",{on:{"tab-click":t.tabChange},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{staticStyle:{width:"99.5%"},attrs:{label:"添加回复",name:"addReplyTab"}},[a("tinymce-editor",{ref:"replyEditor",on:{blur:function(e){return t.onReplyEditorBlur(e)},focus:function(e){return t.onReplyEditorFocus(e)},change:function(e){return t.onReplyEditorChange(e)}},model:{value:t.replyContent,callback:function(e){t.replyContent=e},expression:"replyContent"}}),a("el-col",{staticClass:"mt-10 flex",attrs:{span:12}},[a("el-button",{staticStyle:{"margin-right":"10px"},attrs:{size:"small",icon:"el-icon-edit",type:"primary",loading:t.btnLoading},on:{click:t.replyHandleClick}},[t._v(" 回复")]),a("el-upload",{ref:"attachment",attrs:{action:t.attachmentAction,"on-success":t.attachmentSuccessUpload,"with-credentials":"",multiple:"",name:"file"}},[a("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[t._v("上传附件")])],1)],1)],1),a("el-tab-pane",{staticStyle:{width:"99.5%"},attrs:{label:"添加备注",name:"addRemarksTab"}},[a("tinymce-editor",{ref:"remarkEditor",staticClass:"tinymce",on:{blur:function(e){return t.onRemarkEditorBlur(e)},focus:function(e){return t.onRemarkEditorFocus(e)},change:function(e){return t.onRemarkEditorChange(e)}},model:{value:t.remarkContent,callback:function(e){t.remarkContent=e},expression:"remarkContent"}}),a("el-col",{staticClass:"mt-10",attrs:{span:24}},[a("el-button",{attrs:{size:"small",icon:"el-icon-edit",type:"primary",loading:t.btnLoading},on:{click:t.addTicketNoteHandleClick}},[t._v("添加备注")])],1)],1),a("el-tab-pane",{attrs:{label:"选项",name:"optionsTab"}},[a("el-form",{ref:"elForm",attrs:{model:t.formData,"label-width":"100px"}},[a("el-row",{attrs:{gutter:15}},[a("el-row",[a("el-col",{staticStyle:{opacity:"0"},attrs:{md:4,lg:4,xl:4}},[t._v(".")]),a("el-col",{attrs:{sm:24,md:8,lg:8,xl:8}},[a("el-form-item",{attrs:{label:"部门",prop:"dptid"}},[a("el-select",{style:{width:"100%"},attrs:{size:"small",placeholder:"请选择部门",clearable:""},model:{value:t.formData.dptid,callback:function(e){t.$set(t.formData,"dptid",e)},expression:"formData.dptid"}},t._l(t.dptidOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1)],1),a("el-col",{attrs:{xs:24,sm:24,md:8,lg:8,xl:8}},[a("el-form-item",{attrs:{label:"客户名",prop:"uid"}},[a("el-autocomplete",{style:{width:"100%"},attrs:{"trigger-on-focus":!0,size:"small","fetch-suggestions":t.querySearchAsync,placeholder:"请输入用户"},on:{input:t.clearUid,select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.item;return[a("el-row",[a("el-col",{attrs:{span:24}},[a("span",{staticStyle:{"font-size":"14px"}},[t._v(t._s(r.username))]),a("span",[t._v(t._s(r.companyname?" ("+r.companyname+")":""))]),a("span",[t._v(t._s(r.id?" - #"+r.id:""))])]),a("el-col",{staticStyle:{"margin-top":"-10px"},attrs:{span:24}},[a("span",{staticStyle:{"font-size":"12px",color:"#999"}},[t._v(t._s(r.email))])])],1)]}}]),model:{value:t.formData.username,callback:function(e){t.$set(t.formData,"username",e)},expression:"formData.username"}})],1)],1)],1),a("el-row",[a("el-col",{staticStyle:{opacity:"0"},attrs:{md:4,lg:4,xl:4}},[t._v(".")]),a("el-col",{attrs:{sm:24,md:8,lg:8,xl:8}},[a("el-form-item",{attrs:{label:"主题",prop:"title"}},[a("el-input",{style:{width:"100%"},attrs:{size:"small",placeholder:"请输入主题",clearable:""},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1)],1),a("el-col",{attrs:{sm:24,md:8,lg:8,xl:8}},[a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-select",{style:{width:"100%"},attrs:{size:"small",placeholder:"请选择状态",clearable:""},model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},t._l(t.statusOptions,(function(t,e){return a("el-option",{key:e,style:{color:t.color},attrs:{label:t.title,value:t.id}})})),1)],1)],1)],1),a("el-col",{staticClass:"tac",attrs:{span:24}},[a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary",loading:t.btnLoading},on:{click:t.submitForm}},[t._v("保存更改")]),a("el-button",{attrs:{size:"small"},on:{click:t.resetForm}},[t._v("取消更改")])],1)],1)],1)],1)],1),a("el-tab-pane",{attrs:{lazy:"",label:"产品信息",name:"productInfo"}},[a("ticketTable",{attrs:{uid:t.search.uid,hostid:t.search.hostid}})],1)],1)],1),a("div",{staticClass:"detail_third"},[t.associatTableData.length?a("el-table",{staticClass:"mb-10",staticStyle:{width:"100%"},attrs:{data:t.associatTableData}},[a("el-table-column",{attrs:{prop:"productname",label:"关联产品",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-link",{on:{click:function(e){return t.goProduct(r)}}},[a("el-col",[t._v(t._s(r.productname))]),r.domain?a("el-col",{staticClass:"second-row"},[t._v(t._s(r.domain))]):t._e()],1)]}}],null,!1,475489558)}),a("el-table-column",{attrs:{prop:"amount",label:"金额",width:"180"}}),a("el-table-column",{attrs:{prop:"billingcycle",label:"付款周期"}}),a("el-table-column",{attrs:{prop:"create_time",label:"开通时间"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.$moment(1e3*a.create_time).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}],null,!1,3874438563)}),a("el-table-column",{attrs:{prop:"nextduedate",label:"到期时间"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.$moment(1e3*a.nextduedate).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}],null,!1,3438462250)}),a("el-table-column",{attrs:{prop:"domainstatus",label:"状态"}})],1):t._e(),t.replyList.length?t._l(t.replyList,(function(e,r){return a("div",{key:r,staticClass:"dialogue",style:{background:t.backgroundColor(e)}},["log"!==e.type?[a("div",{staticClass:"dialogue_head"},[a("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},["管理员"===e.user_type?a("use",{attrs:{"xlink:href":"#icon-fuwudingyue"}}):a("use",{attrs:{"xlink:href":"#icon-gerenrenzheng"}})])]),a("div",{staticClass:"dialogue_info"},[a("div",{staticClass:"dialogue_info_first"},[a("div",{staticClass:"info_first_text"},[e.admin_id>0?a("span",{staticClass:"dialogue_info_name color-333 fz-14  mr-10"},[t._v(" "+t._s(e.realname?e.realname:e.user))]):a("router-link",{attrs:{to:{path:"/customer-view/abstract",query:{id:e.uid}}}},[a("el-link",{staticClass:"dialogue_info_name color_primary mr-10",staticStyle:{"font-size":"14px !important"}},[t._v(" "+t._s(e.realname?e.realname:e.user))])],1),a("span",{staticClass:"dialogue_info_type fz-12 color-999 mr-10"},[t._v(t._s(e.user_type)+t._s(t._f("typeFilter")(e.type)))]),a("span",{staticClass:"fz-12 color-999 mr-20"},[t._v(t._s(e.format_time))]),"r"===e.type&&e.star>0?a("span",[a("el-rate",{attrs:{disabled:"",colors:["#ffa000","#ffa000","#ffa000"],"void-color":"#e6e8f0","disabled-void-color":"#e6e8f0"},model:{value:e.star,callback:function(a){t.$set(e,"star",a)},expression:"item.star"}})],1):t._e()],1),a("div",{staticClass:"info_first_btn"},[a("i",{directives:[{name:"show",rawName:"v-show",value:e.showInfo&&"r"===e.type,expression:"item.showInfo && item.type === 'r'"}],staticClass:"el-icon-edit color_primary",on:{click:function(a){return t.editReplayHandleClick(e.id,e.content,"edit")}}}),"t"!==e.type?a("i",{staticClass:"el-icon-delete color_danger",on:{click:function(a){return t.deleteTicketReply(e.id,e.type)}}}):t._e(),a("span",{directives:[{name:"show",rawName:"v-show",value:!e.showInfo,expression:"!item.showInfo"}],staticClass:"mini__btn_plain",on:{click:function(a){return t.editReplayHandleClick(e.id,e.content,"cancel")}}},[t._v("取消")]),a("span",{directives:[{name:"show",rawName:"v-show",value:!e.showInfo,expression:"!item.showInfo"}],staticClass:"mini__btn_suc",on:{click:function(a){return t.editTicketReplyHandleClick(e.id,e.type)}}},[t._v("保存")])])]),a("div",{staticClass:"dialogue_info_second"},[e.showInfo?a("div",{staticClass:"fz-12 color-333"},["管理员"===e.user_type?a("div",{domProps:{innerHTML:t._s(e.content)}}):a("pre",{staticStyle:{"white-space":"pre-wrap","font-family":"inherit"}},[t._v(t._s(e.content))])]):t._e()]),e.showInfo&&e.attachment.length?a("div",[a("h4",[t._v("附件")]),t._l(e.attachment,(function(r,n){return a("div",{key:n},[a("el-link",{on:{click:function(a){return t.downAttachment(e.id,e.type,n)}}},[t._v(t._s(t._f("imgFilter")(r))+" ")])],1)}))],2):e.showInfo?t._e():a("div",[a("tinymce-editor",{ref:"myQuillEditor",refInFor:!0,attrs:{tinymceValue:t.content},on:{"update:tinymceValue":function(e){t.content=e},"update:tinymce-value":function(e){t.content=e}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)])]:[a("div",{staticClass:"dialogue_head"},[a("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#icon-jiaohuanshuju"}})])]),a("div",{staticClass:"dialogue_info"},[a("div",{staticClass:"dialogue_info_first"},[a("div",{staticClass:"info_first_text"},[a("span",{staticClass:"fz-12 color-999 mr-20"},[t._v(t._s(e.format_time))])])]),a("div",{staticClass:"dialogue_info_second"},[e.showInfo?a("div",{staticClass:"fz-12 color-333"},[t._v(" "+t._s(e.mode_zh+"：")+" 由"),a("span",{staticClass:"color_primary"},[t._v(t._s(e.from||"-"))]),t._v(" 转交"),a("span",{staticClass:"color_primary"},[t._v(t._s(e.to||"-"))])]):t._e()]),e.remarks?a("div",{staticClass:"dialogue_info_third fz-12 color-333"},[t._v(" 备注："+t._s(e.remarks)+" ")]):t._e()])]],2)})):t._e()],2),a("el-dialog",t._g(t._b({attrs:{visible:t.transferVis,title:"移交工单",width:"500px"},on:{"update:visible":function(e){t.transferVis=e},open:t.onOpen,close:t.onClose}},"el-dialog",t.$attrs,!1),t.$listeners),[a("el-form",{ref:"transferForm",attrs:{model:t.transferFormData,rules:t.transferRules,size:"small","label-width":"100px"}},[a("el-form-item",{attrs:{label:"转移方式",prop:"mode"}},[a("el-radio-group",{staticClass:"customRadio",attrs:{size:"medium"},model:{value:t.transferFormData.mode,callback:function(e){t.$set(t.transferFormData,"mode",e)},expression:"transferFormData.mode"}},t._l(t.modeOptions,(function(e,r){return a("el-radio",{key:r,attrs:{label:e.value,disabled:e.disabled}},[t._v(" "+t._s(e.label))])})),1)],1),0===t.transferFormData.mode?a("el-form-item",{attrs:{label:"指定处理人",prop:"handle"}},[a("el-select",{style:{width:"100%"},attrs:{placeholder:"请选择指定处理人",clearable:""},model:{value:t.transferFormData.handle,callback:function(e){t.$set(t.transferFormData,"handle",e)},expression:"transferFormData.handle"}},t._l(t.handleOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.user_login,value:t.id,disabled:t.disabled}})})),1)],1):t._e(),1===t.transferFormData.mode?a("el-form-item",{attrs:{label:"处理部门",prop:"dptid"}},[a("el-select",{style:{width:"100%"},attrs:{placeholder:"请选择处理部门",clearable:""},model:{value:t.transferFormData.dptid,callback:function(e){t.$set(t.transferFormData,"dptid",e)},expression:"transferFormData.dptid"}},t._l(t.trDptidOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id,disabled:t.disabled}})})),1)],1):t._e(),a("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[a("el-input",{style:{width:"100%"},attrs:{type:"textarea",placeholder:"请输入备注",autosize:{minRows:4,maxRows:4}},model:{value:t.transferFormData.remarks,callback:function(e){t.$set(t.transferFormData,"remarks",e)},expression:"transferFormData.remarks"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onClose}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",loading:t.trDiaLoading},on:{click:t.handelConfirm}},[t._v("确定")])],1)],1)],1)},n=[],s=(a("4160"),a("a9e3"),a("ac1f"),a("841c"),a("1276"),a("159b"),a("96cf"),a("1da1")),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[a("el-table",{staticClass:"mt-10 ticket-host",staticStyle:{width:"100%"},attrs:{data:t.ticketDetailHosts,"row-class-name":t.tableRowClassName,border:""},on:{"sort-change":t.sortChange}},[a("el-table-column",{attrs:{prop:"productname",label:"产品/服务",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("router-link",{staticClass:"product",attrs:{to:{name:"productInnerpage",query:{id:r.uid,hid:r.id}},target:"_blank"}},[a("el-row",[a("el-col",[a("el-link",[t._v(t._s(r.productname))])],1),a("el-col",[a("span",{staticClass:"second-row"},[t._v(t._s(r.domain))])])],1)],1)]}}])}),a("el-table-column",{attrs:{prop:"amount",label:"金额",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return["一次性"===r.billingcycle?a("span",[t._v(t._s(r.firstpaymentamount)+"/一次性")]):"免费"===r.billingcycle?a("span",[t._v("免费")]):a("span",[t._v(t._s(r.amount))])]}}])}),a("el-table-column",{attrs:{prop:"billingcycle",label:"付款周期",sortable:""}}),a("el-table-column",{attrs:{prop:"create_time",label:"开通时间",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.create_time?t.$moment(1e3*a.create_time).format("YYYY-MM-DD HH:mm"):"-")+" ")]}}])}),a("el-table-column",{attrs:{prop:"nextduedate",label:"到期时间",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.nextduedate?t.$moment(1e3*a.nextduedate).format("YYYY-MM-DD HH:mm"):"-")+" ")]}}])}),a("el-table-column",{attrs:{prop:"domainstatus",label:"状态",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("span",{style:{color:r.status_color}},[t._v(t._s(r.domainstatus))])]}}])})],1),a("el-pagination",{staticClass:"mt-10",attrs:{"current-page":t.search.page,"page-sizes":[10,15,20,25,50,100],"page-size":t.search.limit,total:t.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":function(e){return t.getTicketHosts(0)},"update:currentPage":function(e){return t.$set(t.search,"page",e)},"update:current-page":function(e){return t.$set(t.search,"page",e)},"update:pageSize":function(e){return t.$set(t.search,"limit",e)},"update:page-size":function(e){return t.$set(t.search,"limit",e)}}})],1)},o=[],c=a("a200"),l={props:{uid:{type:Number,default:0},hostid:{type:Number,default:0}},data:function(){return{total:0,search:{uid:0,hostid:0,order:"id",sort:"desc",limit:Number(localStorage.getItem("limit"))||50,page:1,search_all:0,source:"ticket"},ticketDetailHosts:[]}},created:function(){this.getTicketHosts()},mounted:function(){},methods:{tableRowClassName:function(t){var e=t.row;t.rowIndex;if(e.related)return"ticket-related"},sortChange:function(t,e,a){this.search.orderby=t.prop,this.search.sort="ascending"===t.order?"asc":"desc",this.getTicketHosts()},handleSizeChange:function(t){this.search.page=1,this.getTicketHosts()},getTicketHosts:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.search.search_all=t?1:0,a.next=3,Object(c["o"])(e.search);case 3:r=a.sent,n=r.data,200!==n.status?e.$message.error(n.msg):(e.ticketDetailHosts=n.hosts,e.total=n.total);case 6:case"end":return a.stop()}}),a)})))()}},computed:{},watch:{uid:{handler:function(t){this.search.uid=t},immediate:!0},hostid:{handler:function(t){this.search.hostid=t},immediate:!0}}},u=l,d=a("2877"),m=Object(d["a"])(u,i,o,!1,null,"5f2beb50",null),f=m.exports,p=a("af9c"),h=a("5394"),g={metaInfo:{title:"支持工单"},components:{ticketTable:f},data:function(){return{handoverItemLoading:!1,trDiaLoading:!1,receiveLoading:!1,associatTableData:[],related:{host:""},id:this.$route.query.id,tid:this.$route.query.tid,statusOptions:[],activeName:"addReplyTab",replyContent:"",remarkContent:"",formData:{username:"",dptid:void 0,uid:void 0,title:void 0,flag:void 0,status:void 0,cc:void 0},dptidOptions:[],uidOptions:[],flagOptions:[],replyList:[],content:"",fieldname:"",attachmentAction:this.$baseUrl+"/upload_file",attachmentfileList:[],btnLoading:!1,noPower:!1,ticketDetailHosts:[],search:{uid:0,hostid:0,order:"id",sort:"desc",limit:Number(localStorage.getItem("limit"))||50,page:1,search_all:0,source:"ticket"},total:0,transferVis:!1,transferFormData:{id:this.$route.query.id,mode:0,handle:void 0,dptid:void 0,remarks:void 0},transferRules:{mode:[{required:!0,message:"转移方式不能为空",trigger:"change"}],handle:[{required:!0,message:"请选择指定处理人",trigger:"change"}],dptid:[{required:!0,message:"请选择处理部门",trigger:"change"}],remarks:[]},modeOptions:[{label:"指定处理人",value:0},{label:"指定处理部门",value:1}],handleOptions:[],trDptidOptions:[]}},filters:{typeFilter:function(t){switch(t){case"t":return"工单";case"r":return"回复";case"n":return"备注"}},imgFilter:function(t){var e=t.split("^");return e[1]}},methods:{goProduct:function(t){this.$router.push({name:"productInnerpage",query:{id:t.uid,hid:t.id}})},backgroundColor:function(t){return"管理员"===t.user_type?"#faf8f1":"用户"===t.user_type?"#f3f6f9":"移交"===t.user_type?"#ffeccc":void 0},ticketReceive:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.receiveLoading=!0,a={id:t.$route.query.id},e.next=4,Object(c["r"])(a);case 4:if(r=e.sent,n=r.data,200===n.status){e.next=10;break}return t.$message.error(n.msg),t.receiveLoading=!1,e.abrupt("return");case 10:t.$message.success(n.msg),t.receiveLoading=!1,t.getTicketDetail();case 13:case"end":return e.stop()}}),e)})))()},onOpen:function(){},onClose:function(){var t=this;this.$nextTick((function(){t.$refs.transferForm.resetFields(),t.transferVis=!1}))},handelConfirm:function(){var t=this;this.$refs.transferForm.validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return t.trDiaLoading=!0,e.next=5,Object(c["t"])(t.transferFormData);case 5:if(r=e.sent,n=r.data,200===n.status){e.next=11;break}return t.$message.error(n.msg),t.trDiaLoading=!1,e.abrupt("return");case 11:t.$message.success(n.msg),t.trDiaLoading=!1,t.onClose(),t.getTicketDetail();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},clearUid:function(){this.formData.uid=""},handleSelect:function(t){"notFound"!==t.type&&(this.formData.username=t.username,this.formData.uid=t.id)},handoverItem:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.handoverItemLoading=!0,a={id:t.$route.query.id},e.next=4,Object(c["s"])(a);case 4:if(r=e.sent,n=r.data,200===n.status){e.next=10;break}return t.$message.error(n.msg),t.handoverItemLoading=!1,e.abrupt("return");case 10:t.handleOptions=n.data.admins,t.trDptidOptions=n.data.departments,t.transferVis=!0,t.handoverItemLoading=!1;case 14:case"end":return e.stop()}}),e)})))()},querySearchAsync:function(t,e){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,s,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Object(p["f"])(t);case 2:if(n=r.sent,s=n.data,200===s.status){r.next=7;break}return a.$message.error(s.msg),r.abrupt("return");case 7:s.data.length?e(s.data):(i=[{username:"未找到相关数据",type:"notFound"}],e(i));case 8:case"end":return r.stop()}}),r)})))()},attachmentBeforeUpload:function(t){var e=t.size/1024/1024<1;return e||this.$message.error("文件大小超过 1MB"),e},attachmentSuccessUpload:function(t,e,a){this.attachmentfileList.push(t.data.savename)},closeTicketHandleClick:function(t,e){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(4!==t||"confirm"!==e){r.next=4;break}a.$confirm("将关闭此工单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["c"])({id:[a.id],status:t}).then((function(t){var e=t.data;200===e.status?(a.$message.success(e.msg),a.getTicketDetail()):a.$message.error(e.msg)}))})).catch((function(){})),r.next=9;break;case 4:return r.next=6,Object(c["c"])({id:[a.id],status:t});case 6:n=r.sent,s=n.data,200===s.status?(a.$message.success(s.msg),a.getTicketDetail()):a.$message.warning(s.msg);case 9:case"end":return r.stop()}}),r)})))()},tabChange:function(t){"optionsTab"===t.paneName&&this.getAddPageInfoList()},getStatus:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(h["e"])();case 2:a=e.sent,r=a.data,200===r.status?(t.statusOptions=r.data,t.noPower=!1):(t.$message.error(r.msg),t.noPower=!0);case 5:case"end":return e.stop()}}),e)})))()},getTicketDetail:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["m"])(t.id);case 2:a=e.sent,r=a.data,200===r.status?(t.related=r.data.ticket,t.replyList=r.data.list,t.associatTableData=r.data.ticket.host,(t.replyList||[]).forEach((function(e){e.content=t.HTMLDecode(e.content),e.showInfo=!0})),t.replyContent=r.data.user.signature,t.formData=r.data.ticket,t.search.uid=r.data.ticket.uid,t.search.hostid=r.data.ticket.hostid):t.$message.error(r.msg);case 5:case"end":return e.stop()}}),e)})))()},onReplyEditorReady:function(t){},onReplyEditorBlur:function(){},onReplyEditorFocus:function(){},onReplyEditorChange:function(){},replyHandleClick:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.btnLoading=!0,e.next=3,Object(c["q"])({id:t.id,content:t.replyContent,attachment:t.attachmentfileList});case 3:a=e.sent,r=a.data,200===r.status?(t.getTicketDetail(),t.replyContent="",t.$message.success(r.msg),t.$refs.attachment.clearFiles(),t.attachmentfileList=[],t.$router.push("/support-ticket")):t.$message.error(r.msg),t.btnLoading=!1;case 7:case"end":return e.stop()}}),e)})))()},onRemarkEditorReady:function(t){},onRemarkEditorBlur:function(){},onRemarkEditorFocus:function(){},onRemarkEditorChange:function(){},addTicketNoteHandleClick:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.btnLoading=!0,e.next=3,Object(c["a"])({id:t.id,content:t.remarkContent});case 3:a=e.sent,r=a.data,t.$message.success(r.msg),200===r.status&&(t.getTicketDetail(),t.remarkContent=""),t.btnLoading=!1;case 8:case"end":return e.stop()}}),e)})))()},getAddPageInfoList:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r,n,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={tid:t.$route.query.tid},e.next=3,Object(c["j"])(a);case 3:r=e.sent,n=r.data,200===n.status?(t.dptidOptions=n.data.department,t.formData.username=null===(s=n.data)||void 0===s?void 0:s.client.username,t.formData.uid=null===(i=n.data)||void 0===i?void 0:i.client.id,t.uidOptions=n.data.client,t.flagOptions=n.data.client):t.$message.error(n.msg);case 6:case"end":return e.stop()}}),e)})))()},submitForm:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.formData.customfield=[],t.formData.id=Number(t.id),t.btnLoading=!0,e.next=5,Object(c["h"])(t.$qs.stringify(t.formData));case 5:a=e.sent,r=a.data,200===r.status?(t.$message.success(r.msg),t.getTicketDetail(),t.getAddPageInfoList(),t.getStatus()):t.$message.error(r.msg),t.btnLoading=!1;case 9:case"end":return e.stop()}}),e)})))()},resetForm:function(){this.$refs.elForm.resetFields()},HTMLDecode:function(t){var e=document.createElement("div");e.innerHTML=t;var a=e.innerText||e.textContent;return e=null,a},editReplayHandleClick:function(t,e,a){var r=this,n=this.replyList;this.replyList=[],(n||[]).forEach((function(e){"edit"===a?e.id===t?e.showInfo=!1:e.showInfo=!0:"cancel"===a&&(e.showInfo=!0),r.replyList.push(e)})),this.content=e},editTicketReplyHandleClick:function(t,e){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Object(c["i"])({id:t,content:a.content,type:e});case 2:n=r.sent,s=n.data,200===s.status?(a.$message.success("保存成功"),a.getTicketDetail()):a.$message.error(s.msg);case 5:case"end":return r.stop()}}),r)})))()},deleteTicketReply:function(t,e){var a=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function r(){var n,s,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if("r"!==e){r.next=8;break}return r.next=3,Object(c["e"])({id:t});case 3:n=r.sent,s=n.data,200===s.status?a.getTicketDetail():a.$message.warning(s.msg),r.next=14;break;case 8:if("n"!==e){r.next=14;break}return r.next=11,Object(c["d"])({id:t});case 11:i=r.sent,o=i.data,200===o.status?a.getTicketDetail():a.$message.warning(o.msg);case 14:case"end":return r.stop()}}),r)})))).catch((function(){}))},replyIconHandleClick:function(){this.activeName="addReplyTab"},showAttachment:function(t){window.open("http://"+t)},downAttachment:function(t,e,a){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var s,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(c["g"])({id:t,type:e,index:a});case 2:s=n.sent,i=s.data,200!==i.status?r.$message.error(i.msg):open(i.data.filename);case 5:case"end":return n.stop()}}),n)})))()},getTicketHosts:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t&&(e.search.search_all=1),a.next=3,Object(c["o"])(e.search);case 3:r=a.sent,n=r.data,200!==n.status?e.$message.error(n.msg):(e.ticketDetailHosts=n.hosts,e.total=n.total);case 6:case"end":return a.stop()}}),a)})))()},sortChange:function(t,e,a){this.search.order=t.prop,"ascending"===t.order?this.search.sort="asc":this.search.sort="desc",this.getTicketHosts()},handleSizeChange:function(t){this.search.page=1,this.getTicketHosts()},handleCurrentChange:function(t){this.getTicketHosts()},tableRowClassName:function(t){var e=t.row;t.rowIndex;if(e.related)return"ticket-related"}},created:function(){this.getStatus(),this.getTicketDetail()}},v=g,b=(a("9c4d"),Object(d["a"])(v,r,n,!1,null,"784fed2c",null));e["default"]=b.exports}}]);