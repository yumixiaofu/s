(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CustomerAnnex~31ecd969"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"841c":function(e,t,r){"use strict";var a=r("d784"),n=r("825a"),s=r("1d80"),i=r("129f"),o=r("14c3");a("search",1,(function(e,t,r){return[function(t){var r=s(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,r):new RegExp(t)[e](String(r))},function(e){var a=r(t,e,this);if(a.done)return a.value;var s=n(e),l=String(this),u=s.lastIndex;i(u,0)||(s.lastIndex=0);var c=o(s,l);return i(s.lastIndex,u)||(s.lastIndex=u),null===c?-1:c.index}]}))},a505:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.openDia}},[e._v("上传")]),r("el-row",{staticClass:"mt-20"},[r("el-col",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"light"},on:{"sort-change":e.changeSort}},[r("el-table-column",{attrs:{prop:"name",label:"附件名称",sortable:"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-link",{on:{click:function(t){return e.download(a.id)}}},[e._v(e._s(a.name))])]}}])}),r("el-table-column",{attrs:{prop:"create_time",label:"上传时间",width:"135",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(0===r.create_time?"-":e.$moment(1e3*r.create_time).format("YYYY-MM-DD HH:mm"))+" ")]}}])}),r("el-table-column",{attrs:{prop:"user_nickname",label:"上传人",sortable:""}}),r("el-table-column",{attrs:{prop:"downame",label:"文件名",sortable:"","show-overflow-tooltip":""}}),r("el-table-column",{attrs:{prop:"remarks",label:"备注",sortable:"","show-overflow-tooltip":""}}),r("el-table-column",{attrs:{label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{staticClass:"span-primary",attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(t){return e.editRow(a.id)}}},[e._v("编辑 ")]),r("el-button",{staticClass:"span-danger",attrs:{type:"text",size:"small",icon:"el-icon-circle-close"},on:{click:function(t){return e.delRow(a.id)}}},[e._v("删除")])]}}])})],1),r("el-pagination",{attrs:{"current-page":e.search.page,"page-sizes":[10,15,20,25,50,100],"page-size":e.search.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.getUserDown,"update:currentPage":function(t){return e.$set(e.search,"page",t)},"update:current-page":function(t){return e.$set(e.search,"page",t)},"update:pageSize":function(t){return e.$set(e.search,"limit",t)},"update:page-size":function(t){return e.$set(e.search,"limit",t)}}})],1)],1),r("el-dialog",e._g(e._b({attrs:{visible:e.addDiaVis,title:e.isEdit?"编辑":"添加",width:"500px"},on:{"update:visible":function(t){e.addDiaVis=t},open:e.onOpen}},"el-dialog",e.$attrs,!1),e.$listeners),[r("el-row",{attrs:{gutter:15,span:23}},[r("el-form",{ref:"elForm",attrs:{model:e.formData,rules:e.rules,size:"medium","label-width":"auto"}},[e.isEdit?e._e():r("el-form-item",{attrs:{label:"选择文件",prop:"field105"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("span",{staticStyle:{color:"#f00",display:"inline-block","margin-right":"5px"}},[e._v("*")]),e._v("选择文件 ")]),r("el-upload",{ref:"field105",attrs:{"on-success":e.onSuccess,"on-remove":e.onRemove,"on-exceed":e.onExceed,limit:1,data:{uid:e.$route.query.id},action:e.field105Action,"before-upload":e.field105BeforeUpload,"file-list":e.upList,name:"uploadfile"}},[r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-upload"}},[e._v("点击上传")])],1)],1),r("el-form-item",{attrs:{label:"附件名称",prop:"name"}},[r("el-input",{style:{width:"100%"},attrs:{placeholder:"请输入附件名称",clearable:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),r("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[r("el-input",{style:{width:"100%"},attrs:{type:"textarea",placeholder:"请输入备注",maxlength:30,"show-word-limit":"",autosize:{minRows:4,maxRows:4}},model:{value:e.formData.remarks,callback:function(t){e.$set(e.formData,"remarks",t)},expression:"formData.remarks"}})],1)],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.close}},[e._v("取消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handelConfirm}},[e._v("确定")])],1)],1)],1)},n=[],s=(r("b0c0"),r("a9e3"),r("ac1f"),r("841c"),r("96cf"),r("1da1")),i=r("a27e");function o(e){return Object(i["a"])({url:"downloads/userdownlist",params:e})}function l(e){return Object(i["a"])({url:"downloads/adduserfile",method:"post",data:e})}function u(e){return Object(i["a"])({url:"downloads/userfilepage",params:e})}function c(e){return Object(i["a"])({url:"downloads/saveuserfile",method:"post",params:e})}function d(e){return Object(i["a"])({url:"downloads/userfile",params:e})}var m={data:function(){var e=this,t=function(t,r,a){0===e.upList.length?a(new Error("请上传文件")):a()};return{isEdit:!1,search:{page:1,limit:Number(localStorage.getItem("limit"))||50,order:"id",sort:"DESC"},addDiaVis:!1,formData:{uid:void 0,name:void 0,remarks:void 0,filename:""},rules:{name:[{required:!0,message:"请输入附件名称",trigger:"blur"}],remarks:[],field105:[{validator:t,trigger:"blur"}]},field105Action:this.$baseUrl+"/downloads/uploaduserfile?uid="+this.$route.query.id,upList:[],tableData:[],total:0}},created:function(){this.getUserDown()},mounted:function(){},methods:{openDia:function(){var e=this;this.isEdit=!1,this.upList=[],this.$nextTick((function(){e.$refs.elForm.resetFields()})),this.addDiaVis=!0},download:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:open(t.$baseUrl+"/downloads/getuserfile?id="+e+"&uid="+t.$route.query.id);case 1:case"end":return r.stop()}}),r)})))()},delRow:function(e){var t=this;this.$confirm("将删除此文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var r={id:e};d(r).then((function(e){200!==e.data.status?t.$message.error(e.data.msg):(t.$message.success(e.data.msg),t.getUserDown())}))})).catch((function(){}))},editRow:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.isEdit=!0,t.addDiaVis=!0,a={id:e},r.next=5,u(a);case 5:if(n=r.sent,s=n.data,200===s.status){r.next=10;break}return t.$message.error(s.msg),r.abrupt("return");case 10:t.formData.name=s.data.name,t.formData.remarks=s.data.remarks,t.formData.id=e;case 13:case"end":return r.stop()}}),r)})))()},handleSizeChange:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.search.page=1,e.getUserDown();case 2:case"end":return t.stop()}}),t)})))()},changeSort:function(e){"amount_in"!==e.prop&&("descending"===e.order?(this.search.order=e.prop,this.search.sort="DESC"):(this.search.order=e.prop,this.search.sort="AESC"),this.getUserDown())},getUserDown:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={uid:e.$route.query.id},t.next=3,o(r);case 3:if(a=t.sent,n=a.data,200===n.status){t.next=8;break}return e.$message.error(n.msg),t.abrupt("return");case 8:e.tableData=n.data,e.total=n.total;case 10:case"end":return t.stop()}}),t)})))()},onExceed:function(){this.$message.warning("单次文件最多上传一个")},onSuccess:function(e,t,r){if(200!==e.status)return this.$message.error(e.msg),this.formData.filename="",void(this.upList=[]);var a={name:t.raw.name};this.upList.push(a),this.formData.filename=e.data.savename,this.formData.name=t.raw.name},onRemove:function(e,t){this.upList=[],this.formData.filename=""},onOpen:function(){var e=this;this.$nextTick((function(){e.$refs.elForm.resetFields()})),this.formData.uid=this.$route.query.id},close:function(){var e=this;this.addDiaVis=!1,this.upList=[],this.formData.filename="",this.formData.uid="",this.$nextTick((function(){e.$refs.elForm.resetFields()})),this.isEdit=!1},handelConfirm:function(){var e=this;this.$refs.elForm.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var a,n,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return");case 2:if(!e.isEdit){t.next=15;break}return t.next=5,c(e.formData);case 5:if(a=t.sent,n=a.data,200===n.status){t.next=10;break}return e.$message.error(n.msg),t.abrupt("return");case 10:e.$message.success(n.data),e.getUserDown(),e.close(),t.next=25;break;case 15:return t.next=17,l(e.formData);case 17:if(s=t.sent,i=s.data,200===i.status){t.next=22;break}return e.$message.error(i.data),t.abrupt("return");case 22:e.$message.success(i.data),e.getUserDown(),e.close();case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},field105BeforeUpload:function(e){this.upList.length&&this.$message.warning("做多1个");var t=e.size/1024/1024<32;return t||this.$message.error("文件大小超过 32MB"),t}},computed:{},watch:{}},f=m,p=r("2877"),h=Object(p["a"])(f,a,n,!1,null,"5c5485e2",null);t["default"]=h.exports}}]);