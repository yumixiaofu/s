(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["SystemMessage~31ecd969"],{1276:function(e,t,r){"use strict";var s=r("d784"),a=r("44e7"),n=r("825a"),i=r("1d80"),o=r("4840"),l=r("8aa5"),c=r("50c4"),u=r("14c3"),m=r("9263"),p=r("d039"),d=[].push,f=Math.min,g=4294967295,h=!p((function(){return!RegExp(g,"y")}));s("split",2,(function(e,t,r){var s;return s="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var s=String(i(this)),n=void 0===r?g:r>>>0;if(0===n)return[];if(void 0===e)return[s];if(!a(e))return t.call(s,e,n);var o,l,c,u=[],p=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,h=new RegExp(e.source,p+"g");while(o=m.call(h,s)){if(l=h.lastIndex,l>f&&(u.push(s.slice(f,o.index)),o.length>1&&o.index<s.length&&d.apply(u,o.slice(1)),c=o[0].length,f=l,u.length>=n))break;h.lastIndex===o.index&&h.lastIndex++}return f===s.length?!c&&h.test("")||u.push(""):u.push(s.slice(f)),u.length>n?u.slice(0,n):u}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var a=i(this),n=void 0==t?void 0:t[e];return void 0!==n?n.call(t,a,r):s.call(String(a),t,r)},function(e,a){var i=r(s,e,this,a,s!==t);if(i.done)return i.value;var m=n(e),p=String(this),d=o(m,RegExp),b=m.unicode,v=(m.ignoreCase?"i":"")+(m.multiline?"m":"")+(m.unicode?"u":"")+(h?"y":"g"),_=new d(h?m:"^(?:"+m.source+")",v),y=void 0===a?g:a>>>0;if(0===y)return[];if(0===p.length)return null===u(_,p)?[p]:[];var w=0,x=0,k=[];while(x<p.length){_.lastIndex=h?x:0;var j,A=u(_,h?p:p.slice(x));if(null===A||(j=f(c(_.lastIndex+(h?0:x)),p.length))===w)x=l(p,x,b);else{if(k.push(p.slice(w,x)),k.length===y)return k;for(var C=1;C<=A.length-1;C++)if(k.push(A[C]),k.length===y)return k;x=w=j}}return k.push(p.slice(w)),k}]}),!h)},"44e7":function(e,t,r){var s=r("861d"),a=r("c6b6"),n=r("b622"),i=n("match");e.exports=function(e){var t;return s(e)&&(void 0!==(t=e[i])?!!t:"RegExp"==a(e))}},"4b64":function(e,t,r){},"51bf":function(e,t,r){"use strict";r.d(t,"h",(function(){return a})),r.d(t,"e",(function(){return n})),r.d(t,"g",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"f",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"k",(function(){return u})),r.d(t,"b",(function(){return m})),r.d(t,"i",(function(){return p})),r.d(t,"j",(function(){return d})),r.d(t,"a",(function(){return f}));var s=r("a27e");function a(){return Object(s["a"])({url:"system/info"})}function n(){return Object(s["a"])({url:"system/lastversion"})}function i(){return Object(s["a"])({url:"system/phpinfo"})}function o(){return Object(s["a"])({url:"system/databaseinfo"})}function l(){return Object(s["a"])({url:"system/optimizeTables",method:"post"})}function c(){return Object(s["a"])({url:"system/downdatabackup",method:"post",responseType:"blob"})}function u(){return Object(s["a"])({url:"system/autoupdate"})}function m(){return Object(s["a"])({url:"system/checkautoupdate"})}function p(e){return Object(s["a"])({url:"system/toggleversion",method:"post",data:e})}function d(){return Object(s["a"])({url:"system/updatecontent"})}function f(e){return Object(s["a"])({url:"system/license",method:"put",data:e})}},"987c":function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box"},[r("el-form",{attrs:{"label-width":"auto"}},[r("el-row",{attrs:{type:"flex",gutter:30}},[r("el-col",{attrs:{xs:24,md:10}},[r("el-card",[r("el-form-item",{attrs:{label:"服务器ip："}},[r("span",[e._v(e._s(e.listArray.server_ip))])]),r("el-form-item",{attrs:{label:"域名："}},[r("span",[e._v(e._s(e.listArray.server_name))])]),r("el-form-item",{attrs:{label:"系统号："}},[r("span",[e._v(e._s(e.listArray.system_token))])]),r("el-form-item",{attrs:{label:"系统当前版本："}},[r("span",[e._v(e._s(e.listArray.install_version)+"-"+e._s(e.listArray.zjmf_system_version_type_last))])]),r("el-form-item",{attrs:{label:"系统最新版本："}},[e.dataLoading?r("span",{staticClass:"el-icon-loading"}):r("span",["no_response"===e.lastVersionCheck?r("el-link",{staticStyle:{"line-height":"20px"},attrs:{href:"https://bbs.idcsmart.com/thread-615-1-1.html",target:"blank"}},[e._v("未检测到最新版本, 请前往手动更新")]):r("span",[r("span",{staticClass:"cursor-pointer mr-10",staticStyle:{color:"#2f54ea"},on:{click:function(t){e.updateContentDialog=!0}}},[e._v("更新内容")]),e._v(e._s(e.lastVersion))])],1)]),r("el-form-item",{attrs:{label:"版本："}},[e.listArray.system_version_type?r("span",{staticClass:"cursor-pointer mr-10",staticStyle:{color:"#2f54ea"},on:{click:e.toggleVersion}},[e._v("更换版本")]):e._e(),e.dataLoading?e._e():r("span",[e._v(e._s("stable"===e.listArray.system_version_type?"正式版":"内测版"))])]),r("el-form-item",{attrs:{label:"授权类型："}},[e.dataLoading?r("span",{staticClass:"el-icon-loading"}):r("span",[0===e.licenseType?r("span",[e._v("免费版")]):e._e(),1===e.licenseType?r("span",[e._v("专业版")]):e._e()])]),r("el-form-item",{attrs:{label:"授权码："}},[r("span",{staticClass:"cursor-pointer mr-10",staticStyle:{color:"#2f54ea"},on:{click:e.openAuthorize}},[e._v("更换授权码")]),e.clientWidth>1366?r("span",[e._v(e._s(e.listArray.system_license))]):e._e()]),e.clientWidth<=1366?r("el-form-item",{staticClass:"systemCode",staticStyle:{"margin-left":"0 !important"},attrs:{label:" "}},[r("span",[e._v(e._s(e.listArray.system_license))])]):e._e(),r("el-form-item",{staticClass:"upload-button",attrs:{label:""}},[e.isLastestVersion?e._e():r("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-upload",loading:e.updateLoading},on:{click:e.updateHandleClick}},[e._v("更新系统")]),e.isLastestVersion?r("el-button",{attrs:{size:"small",plain:"",icon:"el-icon-upload",disabled:""}},[e._v("您已是最新版本")]):e._e()],1)],1)],1),r("el-col",{attrs:{xs:24,md:14}},[r("el-card",[r("el-form-item",{attrs:{label:"端口号："}},[r("span",[e._v(e._s(e.listArray.server_port))])]),r("el-form-item",{attrs:{label:"服务器系统版本："}},[r("span",[e._v(e._s(e.listArray.server_version))])]),r("el-form-item",{attrs:{label:"服务器操作系统："}},[r("span",[e._v(e._s(e.listArray.server_system))])]),r("el-form-item",{attrs:{label:"php版本："}},[r("span",[e._v(e._s(e.listArray.php_version))])]),r("el-form-item",{attrs:{label:"获取PHP安装路径："}},[r("span",[e._v(e._s(e.listArray.include_path))])]),r("el-form-item",{attrs:{label:"PHP运行方式："}},[r("span",[e._v(e._s(e.listArray.php_sapi_name))])]),r("el-form-item",{attrs:{label:"服务器时间："}},[r("span",[e._v(e._s(e.listArray.now_time))])]),r("el-form-item",{attrs:{label:"服务器上传限制："}},[r("span",[e._v(e._s(e.listArray.upload_max_filesize))])]),r("el-form-item",{attrs:{label:"服务脚本最大执行时间："}},[r("span",[e._v(e._s(e.listArray.max_execution_time))])]),r("el-form-item",{attrs:{label:"内存占用："}},[r("span",[e._v(e._s(e.listArray.memory_limit))])]),r("el-form-item",{attrs:{label:"脚本运行占用最大内存："}},[r("span",[e._v(e._s(e.listArray.processor_identifier))])]),r("el-form-item",{attrs:{label:"系统根目录："}},[r("span",[e._v(e._s(e.listArray.system_root))])]),r("el-form-item",{attrs:{label:"获取服务器语言："}},[r("span",[e._v(e._s(e.listArray.http_accept_language))])]),r("el-form-item",{attrs:{label:"数据库版本："}},[r("span",[e._v(e._s(e.listArray.mysql_version))])])],1)],1)],1)],1),r("el-dialog",{attrs:{title:"系统更新进度",visible:e.dialogVisible,width:"30%","show-close":!1,close:e.clearTimer},on:{"update:visible":function(t){e.dialogVisible=t},open:e.getUpdateProgress}},[r("el-progress",{class:{"progress-clear":100===e.progress},attrs:{"text-inside":!0,"stroke-width":26,percentage:e.progress}}),r("div",{staticClass:"tac mt-10"},[r("span",[e._v(e._s(e.updateDesc))])]),100===e.progress?r("div",{staticClass:"tac mt-10"},[r("el-button",{attrs:{size:"small"},on:{click:e.goToInstall}},[e._v("前往安装")])],1):e._e()],1),r("el-dialog",{attrs:{title:"更新内容",visible:e.updateContentDialog,width:"60%"},on:{"update:visible":function(t){e.updateContentDialog=t}}},[r("div",{staticStyle:{width:"100%","max-height":"600px",height:"-webkit-fill-available","overflow-y":"auto"},domProps:{innerHTML:e._s(e.updataContent)}})]),r("el-dialog",{attrs:{title:"更换授权码",visible:e.authorizeVisable,width:"550px"},on:{"update:visible":function(t){e.authorizeVisable=t}}},[r("el-form",{ref:"formData",attrs:{model:e.formData,size:"medium","label-width":"120px"}},[r("el-form-item",{attrs:{label:"授权码",prop:"license",rules:{required:!0,message:"请输入授权码"}}},[r("el-input",{model:{value:e.formData.license,callback:function(t){e.$set(e.formData,"license",t)},expression:"formData.license"}})],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.authorizeVisable=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary",loading:e.authorizeLoading},on:{click:e.submitForm}},[e._v("确 定")])],1)],1)],1)},a=[],n=(r("4160"),r("a9e3"),r("ac1f"),r("1276"),r("159b"),r("96cf"),r("1da1")),i=r("51bf"),o={metaInfo:{title:"系统升级"},data:function(){return{listArray:{},updateLoading:!1,dialogVisible:!1,authorizeVisable:!1,timer:null,progress:0,updateDesc:"",preWindow:null,formData:{license:null},isLastestVersion:!0,updateContentDialog:!1,updataContent:"",dataLoading:!0,lastVersion:"",licenseType:-1,lastVersionCheck:"",authorizeLoading:!1}},methods:{getSystemInfo:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.dataLoading=!0,t.next=3,Object(i["h"])();case 3:r=t.sent,s=r.data,200!==s.status||(e.listArray=s.data,e.getLastVersion(s.data.install_version)),e.dataLoading=!1;case 7:case"end":return t.stop()}}),t)})))()},getLastVersion:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var s,a,n,o,l,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.dataLoading=!0,r.next=3,Object(i["e"])();case 3:s=r.sent,a=s.data,t.dataLoading=!1,200!==a.status?t.$message.error(a.msg):(t.lastVersion=a.data.last_version,t.licenseType=a.data.license_type,t.lastVersionCheck=a.data.last_version_check,n=e.split("."),o=a.data.last_version.split("."),l="",c="",n.forEach((function(e){l+=e})),o.forEach((function(e){c+=e})),Number(l)<Number(c)?t.isLastestVersion=!1:t.isLastestVersion=!0);case 7:case"end":return r.stop()}}),r)})))()},updateHandleClick:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm("我已备份数据, 确认更新","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(n["a"])(regeneratorRuntime.mark((function t(){var r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.dialogVisible=!0,t.next=3,Object(i["k"])();case 3:r=t.sent,s=r.data,200===s.status?(e.$message.success(s.msg),e.getSystemInfo()):503===s.status||s&&e.$message.error(s.msg);case 6:case"end":return t.stop()}}),t)})))).catch((function(){}));case 1:case"end":return t.stop()}}),t)})))()},getUpdateProgress:function(){var e=this;this.timer=setInterval(Object(n["a"])(regeneratorRuntime.mark((function t(){var r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["b"])();case 2:r=t.sent,s=r.data,1001===s.status?(e.progress=Number(s.progress.split("%")[0]),e.updateDesc=s.msg,e.clearTimer()):200===s.status?(e.progress=Number(s.progress.split("%")[0]),e.updateDesc=s.msg):400===s.status&&(e.$message.error(s.msg),e.dialogVisible=!1,e.clearTimer());case 5:case"end":return t.stop()}}),t)}))),2e3)},goToInstall:function(){var e="/upgrade/install.php";this.preWindow&&this.preWindow.close(),this.preWindow=window.open(e)},clearTimer:function(){clearInterval(this.timer)},toggleVersion:function(){var e=this,t="";t="stable"===this.listArray.system_version_type?"\n          当前为正式版，您可升级为内测版<br>\n          1、注意，请不要在商用环境申请内测版。<br>\n          2、所有新功能做完内部初审后都会第一时间向内测用户推送。<br>\n          3、内测版会有诸多小Bug，如遇到，可以论坛或QQ找我们，我们一定负责到底。<br>\n          4、内测意义在于为广大用户找Bug，魔方团队再一次感谢您的积极参与。<br>\n          5、如果你不是愿意付出及肯折腾学习的人，我们不建议申请内测。\n        ":"\n          当前为内测版，您可切换为正式版<br>\n          1.注意，只有当系统有更高版本正式版时，您才可以进行升级<br>\n          2.正式版不在提供新的功能测试<br>\n          3.转为正式版后，您可继续申请为内测版。\n        ",this.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"",dangerouslyUseHTMLString:!0,customClass:"custom-width"}).then(Object(n["a"])(regeneratorRuntime.mark((function t(){var r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["i"])({type:"stable"===e.listArray.system_version_type?"beta":"stable"});case 2:r=t.sent,s=r.data,200!==s.status?e.$message.error(s.msg):(e.$message.success(s.msg),e.getSystemInfo());case 5:case"end":return t.stop()}}),t)})))).catch((function(){}))},getUpdateContent:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["j"])();case 2:r=t.sent,s=r.data,200!==s.status?e.$message.error(s.msg):e.updataContent=s.data;case 5:case"end":return t.stop()}}),t)})))()},openAuthorize:function(){this.formData.license=this.listArray.system_license,this.authorizeVisable=!0},submitForm:function(){var e=this;this.$refs.formData.validate(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(r){var s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=13;break}return e.authorizeLoading=!0,t.next=4,Object(i["a"])(e.formData);case 4:if(s=t.sent,a=s.data,e.authorizeLoading=!1,200===a.status){t.next=10;break}return e.$message.error(a.msg),t.abrupt("return",!1);case 10:e.getSystemInfo(),e.$message.success(a.msg),e.authorizeVisable=!1;case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},created:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getSystemInfo();case 2:e.getUpdateContent();case 3:case"end":return t.stop()}}),t)})))()},computed:{clientWidth:function(){return document.body.clientWidth}}},l=o,c=(r("a22b"),r("2877")),u=Object(c["a"])(l,s,a,!1,null,"adae739e",null);t["default"]=u.exports},a22b:function(e,t,r){"use strict";var s=r("4b64"),a=r.n(s);a.a}}]);