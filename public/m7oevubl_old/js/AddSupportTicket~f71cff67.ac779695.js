(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AddSupportTicket~f71cff67"],{"85e3":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("h2",[t._v("新建工单")]),r("el-divider"),r("el-row",{staticClass:"topform_wrap"},[r("el-form",{ref:"addSupportTicketForm",attrs:{model:t.addSupportTicketFormData,rules:t.addSupportTicketFormRules,"label-width":t.labelWidth}},[r("el-form-item",{attrs:{label:"客户",prop:"name"}},[r("el-autocomplete",{style:{width:"260px"},attrs:{"trigger-on-focus":!0,size:"small","fetch-suggestions":t.querySearchAsync,placeholder:"请输入用户"},on:{input:t.clearUid,select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.item;return[r("el-row",[r("el-col",{attrs:{span:24}},[r("span",{staticStyle:{"font-size":"14px"}},[t._v(t._s(a.username))]),r("span",[t._v(t._s(a.companyname?" ("+a.companyname+")":""))]),r("span",[t._v(t._s(a.id?" - #"+a.id:""))])]),r("el-col",{staticStyle:{"margin-top":"-10px"},attrs:{span:24}},[r("span",{staticStyle:{"font-size":"12px",color:"#999"}},[t._v(t._s(a.email))])])],1)]}}]),model:{value:t.addSupportTicketFormData.username,callback:function(e){t.$set(t.addSupportTicketFormData,"username",e)},expression:"addSupportTicketFormData.username"}})],1),r("el-form-item",{attrs:{label:"名称",prop:"name"}},[r("el-input",{style:{width:"260px"},attrs:{size:"small",placeholder:"请输入名称",clearable:"",disabled:Boolean(t.customerObj)},model:{value:t.addSupportTicketFormData.name,callback:function(e){t.$set(t.addSupportTicketFormData,"name",e)},expression:"addSupportTicketFormData.name"}})],1),r("el-form-item",{attrs:{label:"邮件地址",prop:"email"}},[r("el-input",{style:{width:"260px"},attrs:{size:"small",placeholder:"请输入邮件地址",clearable:"",disabled:Boolean(t.customerObj)},model:{value:t.addSupportTicketFormData.email,callback:function(e){t.$set(t.addSupportTicketFormData,"email",e)},expression:"addSupportTicketFormData.email"}}),r("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"是否发邮件"},model:{value:t.addSupportTicketFormData.send,callback:function(e){t.$set(t.addSupportTicketFormData,"send",e)},expression:"addSupportTicketFormData.send"}})],1),r("el-form-item",{attrs:{label:"主题",prop:"title"}},[r("el-input",{style:{width:"260px"},attrs:{size:"small",placeholder:"请输入主题",clearable:""},model:{value:t.addSupportTicketFormData.title,callback:function(e){t.$set(t.addSupportTicketFormData,"title",e)},expression:"addSupportTicketFormData.title"}})],1),r("el-form-item",{attrs:{label:"部门",prop:"dptid"}},[r("span",{attrs:{slot:"label"},slot:"label"},[t._v(" 部门 "),r("el-popover",{attrs:{placement:"top-start",title:"",width:"200",trigger:"hover"}},[r("el-row",[r("el-col",{attrs:{span:24}},[t._v("选择部门对工单进行分类，可将人员分配到不同的部门，对应处理其各自部门的工单。")]),r("el-col",{staticClass:"tar",attrs:{span:24}},[r("router-link",{attrs:{to:{path:"work-order-dept"},target:"_blank"}},[r("el-link",{attrs:{type:"primary"}},[t._v("设置部门")])],1)],1)],1),r("i",{staticClass:"el-icon-question blue_qus",attrs:{slot:"reference"},slot:"reference"})],1)],1),r("el-select",{style:{width:"260px"},attrs:{size:"small",placeholder:"请选择部门",clearable:""},model:{value:t.addSupportTicketFormData.dptid,callback:function(e){t.$set(t.addSupportTicketFormData,"dptid",e)},expression:"addSupportTicketFormData.dptid"}},t._l(t.deptOptions,(function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1),r("el-form-item",{attrs:{label:"优先级",prop:"priority"}},[r("el-select",{style:{width:"260px"},attrs:{size:"small",placeholder:"请选择优先级",clearable:""},model:{value:t.addSupportTicketFormData.priority,callback:function(e){t.$set(t.addSupportTicketFormData,"priority",e)},expression:"addSupportTicketFormData.priority"}},t._l(t.priorityOptions,(function(t,e){return r("el-option",{key:e,attrs:{label:t.label,value:t.value,disabled:t.disabled}})})),1)],1),r("el-form-item",{attrs:{label:"回复内容",prop:"content"}},[r("el-row",{attrs:{gutter:15}},[r("el-col",{staticStyle:{padding:"0"},attrs:{sm:24,md:20,lg:20,xl:20}},[r("tinymce-editor",{ref:"myQuillEditor",staticStyle:{width:"90%"},attrs:{tinymceValue:t.addSupportTicketFormData.content},on:{"update:tinymceValue":function(e){return t.$set(t.addSupportTicketFormData,"content",e)},"update:tinymce-value":function(e){return t.$set(t.addSupportTicketFormData,"content",e)}},model:{value:t.addSupportTicketFormData.content,callback:function(e){t.$set(t.addSupportTicketFormData,"content",e)},expression:"addSupportTicketFormData.content"}})],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:t.isEditorContentNull,expression:"isEditorContentNull"}],staticClass:"el-form-item__error"},[t._v(" 请输入回复内容 ")])],1),r("el-form-item",{attrs:{label:"附件",prop:"attachment"}},[r("el-upload",{ref:"attachment",attrs:{"file-list":t.attachmentfileList,action:t.attachmentAction,"before-upload":t.attachmentBeforeUpload,"on-success":t.attachmentSuccessUpload,"with-credentials":"",multiple:"",name:"file"}},[r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-upload","on-error":t.uploadErr}},[t._v("点击上传")]),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传不超过 10MB 的文件")])],1)],1)],1)],1),r("div",{staticClass:"bottomOperationAdd"},[r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus",loading:t.btnLoading},on:{click:t.openTicketSubmit}},[t._v("开启工单 ")]),r("el-button",{attrs:{size:"small"},on:{click:t.goBack}},[t._v("返回")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.cancel}},[t._v("取消")])],1)],1)},n=[],o=(r("4160"),r("b0c0"),r("a9e3"),r("159b"),r("96cf"),r("1da1")),i=r("af9c"),u=r("a200"),c={metaInfo:{title:"新建工单"},data:function(){return{labelWidth:window.document.body.clientWidth>768?"100px":null,uid:Number(this.$route.query.uid),id:0,customerObj:null,addSupportTicketFormData:{username:"",uid:void 0,email:void 0,send:0,cc:void 0,title:void 0,dptid:void 0,priority:"high",content:"",attachment:""},addSupportTicketFormRules:{content:[{required:!0,message:"请输入回复内容",trigger:"blur"}],name:[],email:[],cc:[],title:[{required:!0,message:"请输入主题",trigger:"blur"}],dptid:[{required:!0,message:"请选择部门",trigger:"change"}],priority:[]},customerOptions:[],deptOptions:[],priorityOptions:[{label:"高",value:"high"},{label:"中",value:"medium"},{label:"低",value:"low"}],attachmentAction:this.$baseUrl+"/upload_file",attachmentfileList:[],editorOption:{modules:{toolbar:{container:[["bold","italic","underline","strike"],["blockquote"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]}}},isEditorContentNull:!1,btnLoading:!1}},methods:{clearUid:function(){this.addSupportTicketFormData.uid=""},handleSelect:function(t){"notFound"!==t.type&&(this.addSupportTicketFormData.username=t.username,this.addSupportTicketFormData.uid=t.id)},querySearchAsync:function(t,e){var r=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var n,o,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(i["f"])(t);case 2:if(n=a.sent,o=n.data,200===o.status){a.next=7;break}return r.$message.error(o.msg),a.abrupt("return");case 7:o.data.length?e(o.data):(u=[{username:"未找到相关数据",type:"notFound"}],e(u));case 8:case"end":return a.stop()}}),a)})))()},uploadErr:function(t,e,r){},getAddPageInfoList:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["j"])();case 2:r=e.sent,a=r.data,200===a.status?(t.customerOptions=a.data.client,t.deptOptions=a.data.department,t.addSupportTicketFormData.dptid=t.deptOptions.length?t.deptOptions[0].id:void 0,(t.customerOptions||[]).forEach((function(e){t.uid===e.id&&(t.customerObj=e,t.customerSelectedChange(t.customerObj))})),t.addSupportTicketFormData.content=a.data.user.signature):t.$message.error(a.msg);case 5:case"end":return e.stop()}}),e)})))()},customerSelectedChange:function(t){this.addSupportTicketFormData.uid=t.id,this.addSupportTicketFormData.name=t.username,this.addSupportTicketFormData.email=t.email},onEditorReady:function(t){},onEditorBlur:function(){""===this.addSupportTicketFormData.content?this.isEditorContentNull=!0:this.isEditorContentNull=!1},onEditorFocus:function(){},onEditorChange:function(){},attachmentBeforeUpload:function(t){var e=t.size/1024/1024<10;return e||this.$message.error("文件大小超过 10MB"),e},attachmentSuccessUpload:function(t,e,r){this.attachmentfileList=r},openTicketSubmit:function(){var t=this;""===this.addSupportTicketFormData.content?this.isEditorContentNull=!0:this.isEditorContentNull=!1,this.addSupportTicketFormData.attachment=[],(this.attachmentfileList||[]).forEach((function(e){t.addSupportTicketFormData.attachment.push(e.response.data.savename)})),this.$refs.addSupportTicketForm.validate(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(r){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r&&!t.isEditorContentNull){e.next=4;break}return e.abrupt("return",!1);case 4:return t.btnLoading=!0,e.next=7,Object(u["b"])(t.addSupportTicketFormData);case 7:if(a=e.sent,n=a.data,200===n.status){e.next=13;break}t.$message.error(n.msg),e.next=18;break;case 13:if(t.$message.success(n.msg),!t.$route.query.uid){e.next=17;break}return t.$router.push({path:"/customer-view/tickets",query:{id:t.$route.query.uid}}),e.abrupt("return",!1);case 17:t.$router.push("/support-ticket");case 18:t.btnLoading=!1;case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},cancel:function(){this.$refs.addSupportTicketForm.resetFields()},goBack:function(){this.$router.go(-1)}},mounted:function(){this.getAddPageInfoList()}},d=c,s=r("2877"),l=Object(s["a"])(d,a,n,!1,null,"faee2fae",null);e["default"]=l.exports},a200:function(t,e,r){"use strict";r.d(e,"j",(function(){return n})),r.d(e,"b",(function(){return o})),r.d(e,"n",(function(){return i})),r.d(e,"q",(function(){return u})),r.d(e,"i",(function(){return c})),r.d(e,"p",(function(){return d})),r.d(e,"c",(function(){return s})),r.d(e,"f",(function(){return l})),r.d(e,"a",(function(){return p})),r.d(e,"d",(function(){return m})),r.d(e,"e",(function(){return f})),r.d(e,"g",(function(){return h})),r.d(e,"m",(function(){return b})),r.d(e,"h",(function(){return k})),r.d(e,"k",(function(){return v})),r.d(e,"l",(function(){return g})),r.d(e,"o",(function(){return _})),r.d(e,"r",(function(){return S})),r.d(e,"s",(function(){return O})),r.d(e,"t",(function(){return y}));var a=r("a27e");function n(t){return Object(a["a"])({url:"add_ticket_page",params:t})}function o(t){return Object(a["a"])({url:"add_ticket",method:"post",data:t})}function i(t){return Object(a["a"])({url:"list_ticket",params:t})}function u(t){return Object(a["a"])({url:"reply_ticket",method:"post",data:t})}function c(t){return Object(a["a"])({url:"save_ticket_reply",method:"post",data:t})}function d(t){return Object(a["a"])({url:"merge_ticket",method:"post",data:t})}function s(t){return Object(a["a"])({url:"close_ticket",method:"post",data:t})}function l(t){return Object(a["a"])({url:"delete_ticket",method:"post",data:t})}function p(t){return Object(a["a"])({url:"add_ticket_note",method:"post",data:t})}function m(t){return Object(a["a"])({url:"delete_ticket_note",method:"post",data:t})}function f(t){return Object(a["a"])({url:"delete_ticket_reply",method:"post",data:t})}function h(t){return Object(a["a"])({url:"download_ticket_attachment",params:t})}function b(t){return Object(a["a"])({url:"list_ticket/"+t})}function k(t){return Object(a["a"])({url:"save_ticket",method:"post",data:t})}function v(){return Object(a["a"])({url:"getClient"})}function g(){return Object(a["a"])({url:"getTicketDepartment"})}function _(t){return Object(a["a"])({url:"hostbyuid",params:t})}function S(t){return Object(a["a"])({url:"ticket_receive",method:"put",data:t})}function O(t){return Object(a["a"])({url:"ticket_transfer_list",params:t})}function y(t){return Object(a["a"])({url:"ticket_transfer",method:"put",data:t})}},af9c:function(t,e,r){"use strict";r.d(e,"l",(function(){return n})),r.d(e,"k",(function(){return o})),r.d(e,"h",(function(){return i})),r.d(e,"a",(function(){return u})),r.d(e,"e",(function(){return c})),r.d(e,"o",(function(){return d})),r.d(e,"c",(function(){return s})),r.d(e,"i",(function(){return l})),r.d(e,"m",(function(){return p})),r.d(e,"j",(function(){return m})),r.d(e,"d",(function(){return f})),r.d(e,"n",(function(){return h})),r.d(e,"p",(function(){return b})),r.d(e,"b",(function(){return k})),r.d(e,"g",(function(){return v})),r.d(e,"f",(function(){return g}));var a=r("a27e");function n(t){return Object(a["a"])({url:"order/search_page",params:t})}function o(t){return Object(a["a"])({url:"order/search",params:t})}function i(t){return Object(a["a"])({url:"order/check",params:t})}function u(t){return Object(a["a"])({url:"order/cancel",params:t})}function c(t){return Object(a["a"])({url:"orders/delete",method:"delete",params:t})}function d(t){return Object(a["a"])({url:"order/create_page",params:t})}function s(t){return Object(a["a"])({url:"order/create",method:"post",data:t})}function l(t){return Object(a["a"])({url:"orders/"+t})}function p(t){return Object(a["a"])({url:"orders/set_config",params:t})}function m(t){return Object(a["a"])({url:"get_total",method:"post",data:t})}function f(t){return Object(a["a"])({url:"order/save_promo_code",method:"post",data:t})}function h(t){return Object(a["a"])({url:"orders/active",method:"post",data:t})}function b(){return Object(a["a"])({url:"order/promo_code_page"})}function k(t){return Object(a["a"])({url:"orders/change_status",method:"post",data:t})}function v(t){return Object(a["a"])({url:"order/order_commission",method:"post",data:t})}function g(t){return Object(a["a"])({url:"order/getclients",params:{username:t}})}}}]);