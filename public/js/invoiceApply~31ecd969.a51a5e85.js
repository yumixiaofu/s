(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["invoiceApply~31ecd969"],{1003:function(e,t,a){},"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"1dde":function(e,t,a){var r=a("d039"),n=a("b622"),i=a("2d00"),o=n("species");e.exports=function(e){return i>=51||!r((function(){var t=[],a=t.constructor={};return a[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},2532:function(e,t,a){"use strict";var r=a("23e7"),n=a("5a34"),i=a("1d80"),o=a("ab13");r({target:"String",proto:!0,forced:!o("includes")},{includes:function(e){return!!~String(i(this)).indexOf(n(e),arguments.length>1?arguments[1]:void 0)}})},"3d98":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"layout_card p-20"},[a("div",{staticClass:"breadcrumb"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/apply-invoice"}}},[a("i",{staticClass:"iconfont icon-fapiao"}),e._v(" 发票管理 ")]),a("el-breadcrumb-item",[e._v("发票申请")])],1)],1),a("div",{staticClass:"font-12 color-999 mb-10 flex-between"},[a("span",[e._v(" 开具发票前请务必保证抬头信息和收获地址正确，如需修改，请前往 "),a("router-link",{staticStyle:{color:"#0e62ff","text-decoration":"none"},attrs:{to:{path:"/apply-invoice",query:{type:"apply"}}}},[e._v("信息管理")]),e._v(" 进行修改或添加 ")],1),a("div",{staticClass:"header_box_back flexc ml-20",on:{click:e.goBack}},[a("span",{staticClass:"iconfont icon-fanhui"})])]),a("el-input",{staticStyle:{width:"260px"},attrs:{size:"mini",placeholder:"请输入账单号搜索"},model:{value:e.search.keywords,callback:function(t){e.$set(e.search,"keywords",t)},expression:"search.keywords"}}),a("el-table",{attrs:{height:e.$height-275,data:e.tableData,"row-class-name":"iRowClass","cell-class-name":"iCellClass","header-row-class-name":"iHeaderRowClass","header-cell-class-name":"iHeaderCellClass"},on:{"sort-change":e.sortChange,"selection-change":e.selectChange}},[a("div",{attrs:{slot:"empty"},slot:"empty"},[!e.tableData.length&&e.tableLoading?a("span",[a("i",{staticClass:"el-icon-loading"}),e._v(" 正在加载 ... ")]):e._e(),e.tableData.length||e.tableLoading?e._e():a("span",[e._v("暂无数据")])]),a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{prop:"notes",label:"账单号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("router-link",{attrs:{to:{path:"/bill-detail",query:{id:r.id}}}},[e._v("#"+e._s(r.id))])]}}])}),a("el-table-column",{attrs:{prop:"subtotal",label:"金额",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.currency.prefix+a.subtotal+e.currency.suffix)+" ")]}}])}),a("el-table-column",{attrs:{prop:"type_zh",label:"类型",align:"center"}}),a("el-table-column",{attrs:{prop:"paid_time",label:"支付时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.$moment(1e3*a.paid_time).format("YYYY-MM-DD HH:mm")))]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{staticClass:"table_btn",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.createInvoice(r)}}},[e._v("开具发票")])]}}])})],1),a("div",{staticClass:"mt-10 flex-between"},[a("el-button",{staticClass:"table_btn",attrs:{size:"small",type:"primary",disabled:!e.createInvoiceFormData.invoice_ids.length},on:{click:function(t){e.createInvoiceDialog=!0}}},[e._v("开具发票")]),a("el-pagination",{attrs:{background:"","current-page":e.search.page,"page-size":e.search.limit,"page-sizes":[10,15,20,25],total:e.total,layout:"total,sizes,prev,pager,next","prev-text":e.$t("Previous"),"next-text":e.$t("Nextpage")},on:{"size-change":e.handleSizeChange,"current-change":e.getData,"update:currentPage":function(t){return e.$set(e.search,"page",t)},"update:current-page":function(t){return e.$set(e.search,"page",t)},"update:pageSize":function(t){return e.$set(e.search,"limit",t)},"update:page-size":function(t){return e.$set(e.search,"limit",t)}}})],1),a("el-dialog",{attrs:{visible:e.createInvoiceDialog,title:"开具发票",width:"700px"},on:{"update:visible":function(t){e.createInvoiceDialog=t},open:e.createInvoiceDialogOpen,close:e.createInvoiceDialogClose}},[a("div",{staticClass:"custom_body"},[a("el-form",{ref:"invoiceForm",attrs:{model:e.createInvoiceFormData,rules:e.createInvoiceRules,"label-width":"80px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"开具类型",prop:"type"}},[a("el-radio-group",{staticClass:"customRadio",on:{change:e.typeChange},model:{value:e.createInvoiceFormData.type,callback:function(t){e.$set(e.createInvoiceFormData,"type",t)},expression:"createInvoiceFormData.type"}},e._l(e.createInvoicePageData.type,(function(t,r){return a("el-radio",{key:r+"type",attrs:{label:r}},[e._v(" "+e._s(t))])})),1)],1)],1),a("el-col",{attrs:{xs:24,sm:24,md:12}},[a("el-form-item",{attrs:{label:"抬头信息",prop:"type_id"}},[a("el-select",{attrs:{size:"small"},model:{value:e.createInvoiceFormData.type_id,callback:function(t){e.$set(e.createInvoiceFormData,"type_id",t)},expression:"createInvoiceFormData.type_id"}},e._l(e.createInvoicePageData.title[e.createInvoiceFormData.type],(function(e,t){return a("el-option",{key:t+"title",attrs:{label:e.title,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{xs:24,sm:24,md:12}},[a("el-form-item",{attrs:{label:"快递信息",prop:"express_id"}},[a("el-select",{attrs:{size:"small"},on:{change:e.expressChange},model:{value:e.createInvoiceFormData.express_id,callback:function(t){e.$set(e.createInvoiceFormData,"express_id",t)},expression:"createInvoiceFormData.express_id"}},e._l(e.createInvoicePageData.express,(function(t,r){return a("el-option",{key:r+"express",attrs:{label:t.name+" (邮费"+e.currency.prefix+t.price+")",value:t.id}})})),1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"邮寄地址",prop:"post_id"}},[a("el-select",{staticStyle:{width:"calc(100% - 20px)"},attrs:{size:"small"},model:{value:e.createInvoiceFormData.post_id,callback:function(t){e.$set(e.createInvoiceFormData,"post_id",t)},expression:"createInvoiceFormData.post_id"}},e._l(e.createInvoicePageData.post,(function(t,r){return a("el-option",{key:r+"post",attrs:{label:t.province+t.city+t.region,value:t.id}},[a("span",{staticClass:"iconfont icon-wujiaoxing",staticStyle:{color:"#ffa000",width:"13px",height:"15px","margin-right":"5px"},style:{opacity:t.default?1:0}}),a("span",[e._v(e._s(t.province+t.city+t.region))])])})),1)],1)],1)],1)],1),a("el-table",{staticClass:"mt-10",attrs:{data:e.createInvoicePageData.invoices,height:"300",border:"","header-row-class-name":"innerTableHeader","row-class-name":"innerTableRowClass","cell-class-name":"innerTableCellClass"},on:{"sort-change":e.sortChange}},[a("div",{attrs:{slot:"empty"},slot:"empty"},[!e.createInvoicePageData.invoices.length&&e.tableLoading?a("span",[a("i",{staticClass:"el-icon-loading"}),e._v(" 正在加载 ... ")]):e._e(),e.createInvoicePageData.invoices.length||e.tableLoading?e._e():a("span",[e._v("暂无数据")])]),a("el-table-column",{attrs:{prop:"description",label:"产品名称"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return e._l(r.items,(function(t,r){return a("pre",{key:r+"subitem",staticClass:"color-999"},[e._v(e._s(t.description))])}))}}])}),a("el-table-column",{attrs:{prop:"subtotal",label:"金额",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.currency.prefix)+e._s(parseFloat(a.subtotal).toFixed(2)))]}}])}),a("el-table-column",{attrs:{prop:"taxed",label:"税率",align:"center",width:"80"}}),a("el-table-column",{attrs:{prop:"taxed_amount",label:"税额",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.currency.prefix)+e._s(parseFloat(a.taxed_amount).toFixed(2)))]}}])})],1),a("div",{staticClass:"flex-between mt-20"},[a("div",[e._v("开发票扣税："+e._s(e.currency.prefix)+e._s(parseFloat(e.createInvoicePageData.voucher_amount).toFixed(2))+" + 发票邮寄快递费用"+e._s(e.currency.prefix)+e._s(e.selectedExpress.price))]),a("div",[a("el-button",{staticClass:"custom_dialog_btn default",attrs:{size:"small"},on:{click:function(t){e.createInvoiceDialog=!1}}},[e._v("取消 ")]),a("el-button",{staticClass:"custom_dialog_btn primary",attrs:{size:"small",type:"primary",loading:e.btnLoading},on:{click:e.submit}},[e._v("确认支付")])],1)])],1)]),a("payNew",{ref:"control",attrs:{title:"支付"},on:{"pay-success":e.successCallBack,close:e.dialogClosed}})],1)},n=[],i=(a("4160"),a("caad"),a("d81d"),a("d3b7"),a("ac1f"),a("2532"),a("841c"),a("159b"),a("ddb0"),a("96cf"),a("1da1")),o=a("3fe4"),c={props:{currency:{type:Object,default:function(){return{prefix:"¥",suffix:"元"}}}},data:function(){return{tableData:[],search:{page:1,limit:10,order:"",sort:"desc",keywords:""},total:0,tableLoading:!1,timer:null,btnLoading:!1,createInvoicePageData:{type:{person:"个人",company:"公司"},express:[],post:[],title:{company:[],person:[]},invoices:[]},selectedExpress:{},createInvoiceDialog:!1,createInvoiceFormData:{type:"person",invoice_ids:[],type_id:void 0,express_id:void 0,post_id:void 0},createInvoiceRules:{type:[{required:!0,message:"请选择开具类型",trigger:"change"}],type_id:[{required:!0,message:"请选择抬头",trigger:"change"}],express_id:[{required:!0,message:"请选择快递",trigger:"change"}],post_id:[{required:!0,message:"请选择地址",trigger:"change"}]}}},created:function(){this.getData()},mounted:function(){},methods:{goBack:function(){this.$router.go(-1)},getData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,Object(o["p"])(e.search);case 3:if(a=t.sent,r=a.data,e.tableLoading=!1,200===r.status){t.next=8;break}return t.abrupt("return",!1);case 8:e.tableData=r.data.invoices,e.total=r.data.total;case 10:case"end":return t.stop()}}),t)})))()},handleSizeChange:function(e){this.search.page=1,this.getData()},sortChange:function(e,t,a){this.search.order=e.prop,"ascending"===e.order?this.search.sort="asc":this.search.sort="desc",this.getData()},searchInput:function(){var e=this;this.timer?clearTimeout(this.timer):this.timer=setTimeout((function(){e.getData()}),200)},selectChange:function(e){this.createInvoiceFormData.invoice_ids=e.map((function(e){return e.id}))},createInvoice:function(e){this.createInvoiceFormData.invoice_ids=[e.id],this.createInvoiceDialog=!0},createInvoiceDialogOpen:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,Object(o["b"])({invoice_ids:e.createInvoiceFormData.invoice_ids});case 3:if(a=t.sent,r=a.data,e.tableLoading=!1,200===r.status){t.next=8;break}return t.abrupt("return",!1);case 8:e.createInvoicePageData=r.data,t.t0=regeneratorRuntime.keys(r.data.type);case 10:if((t.t1=t.t0()).done){t.next=18;break}if(n=t.t1.value,!r.data.title[n]){t.next=16;break}return e.createInvoiceFormData.type=n,e.createInvoiceFormData.type_id=r.data.title[n].length?r.data.title[n][0].id:void 0,t.abrupt("break",18);case 16:t.next=10;break;case 18:e.selectedExpress=r.data.express.length?r.data.express[0]:{},e.createInvoiceFormData.express_id=r.data.express.length?r.data.express[0].id:void 0,(r.data.post||[]).forEach((function(t,a){r.data.post.map((function(e){return e.default})).includes(1)?t.default&&(e.createInvoiceFormData.post_id=t.id):0===a&&(e.createInvoiceFormData.post_id=t.id)}));case 21:case"end":return t.stop()}}),t)})))()},createInvoiceDialogClose:function(){this.$refs.invoiceForm.resetFields(),this.createInvoicePageData.invoices=[],this.createInvoiceFormData.invoice_ids=[]},typeChange:function(){this.createInvoicePageData.title[this.createInvoiceFormData.type]?this.createInvoiceFormData.type_id=this.createInvoicePageData.title[this.createInvoiceFormData.type].length?this.createInvoicePageData.title[this.createInvoiceFormData.type][0].id:void 0:this.createInvoiceFormData.type_id=void 0},expressChange:function(){var e=this;this.createInvoicePageData.express.forEach((function(t){t.id===e.createInvoiceFormData.express_id&&(e.selectedExpress=t)}))},submit:function(){var e=this;this.$refs.invoiceForm.validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return",!1);case 2:return e.btnLoading=!0,t.next=5,Object(o["c"])(e.createInvoiceFormData);case 5:r=t.sent,n=r.data,e.btnLoading=!1,200===n.status?(e.$message.success(n.msg),e.getData(),e.createInvoiceDialog=!1,e.$refs.control.main({id:n.data.invoice_id,name:"结算"})):1001===n.status?(e.$message.success(n.msg),e.getData(),e.createInvoiceDialog=!1):e.$message.error(n.msg);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},successCallBack:function(e){e&&this.getData()},dialogClosed:function(){this.getData()}},computed:{},watch:{"search.keywords":{handler:function(e){var t=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.getData();case 1:case"end":return e.stop()}}),e)}))),300)},deep:!0}}},s=c,l=(a("8ace"),a("2877")),u=Object(l["a"])(s,r,n,!1,null,"32b797a9",null);t["default"]=u.exports},"3fe4":function(e,t,a){"use strict";a.d(t,"j",(function(){return n})),a.d(t,"e",(function(){return i})),a.d(t,"p",(function(){return o})),a.d(t,"b",(function(){return c})),a.d(t,"c",(function(){return s})),a.d(t,"g",(function(){return l})),a.d(t,"h",(function(){return u})),a.d(t,"i",(function(){return d})),a.d(t,"f",(function(){return p})),a.d(t,"n",(function(){return v})),a.d(t,"l",(function(){return f})),a.d(t,"m",(function(){return m})),a.d(t,"k",(function(){return h})),a.d(t,"o",(function(){return g})),a.d(t,"a",(function(){return b})),a.d(t,"d",(function(){return _}));var r=a("a27e");function n(e){return Object(r["a"])({url:"/voucher/voucherlist",params:e})}function i(e){return Object(r["a"])({url:"/voucher/voucherdetail",params:e})}function o(e){return Object(r["a"])({url:"/voucher/voucherrequest",params:e})}function c(e){return Object(r["a"])({url:"/voucher/issuevoucher",params:e})}function s(e){return Object(r["a"])({url:"/voucher/issuevoucher",method:"post",data:e})}function l(e){return Object(r["a"])({url:"/voucher/voucherinfolist",params:e})}function u(e){return Object(r["a"])({url:"/voucher/voucherinfo",params:e})}function d(e){return Object(r["a"])({url:"/voucher/voucherinfo",method:"post",data:e})}function p(e){return Object(r["a"])({url:"/voucher/voucherinfo",method:"delete",params:e})}function v(e){return Object(r["a"])({url:"/voucher/voucherpostlist",params:e})}function f(e){return Object(r["a"])({url:"/voucher/voucherpost",params:e})}function m(e){return Object(r["a"])({url:"/voucher/voucherpost",method:"post",data:e})}function h(e){return Object(r["a"])({url:"/voucher/voucherpost",method:"delete",data:e})}function g(e){return Object(r["a"])({url:"/voucher/voucherdefaultpost",method:"post",data:e})}function b(){return Object(r["a"])({url:"/voucher/arealist"})}function _(){return Object(r["a"])({url:"/voucher/currency"})}},"44e7":function(e,t,a){var r=a("861d"),n=a("c6b6"),i=a("b622"),o=i("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==n(e))}},"5a34":function(e,t,a){var r=a("44e7");e.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},"841c":function(e,t,a){"use strict";var r=a("d784"),n=a("825a"),i=a("1d80"),o=a("129f"),c=a("14c3");r("search",1,(function(e,t,a){return[function(t){var a=i(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,a):new RegExp(t)[e](String(a))},function(e){var r=a(t,e,this);if(r.done)return r.value;var i=n(e),s=String(this),l=i.lastIndex;o(l,0)||(i.lastIndex=0);var u=c(i,s);return o(i.lastIndex,l)||(i.lastIndex=l),null===u?-1:u.index}]}))},"8ace":function(e,t,a){"use strict";var r=a("1003"),n=a.n(r);n.a},ab13:function(e,t,a){var r=a("b622"),n=r("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(a){try{return t[n]=!1,"/./"[e](t)}catch(r){}}return!1}},d81d:function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").map,i=a("1dde"),o=a("ae40"),c=i("map"),s=o("map");r({target:"Array",proto:!0,forced:!c||!s},{map:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);